<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0d0d1a">
    <meta name="description" content="Waikato Prayer Times â€” Hamilton Jamia Mosque Prayer & Ramadan Timetable">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Waikato Prayer Times">
    <link rel="manifest" href="/prayer-times/manifest.json">
    <link rel="apple-touch-icon" href="/prayer-times/icon-192.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/prayer-times/icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/prayer-times/icon-512.png">
    <title>Waikato Prayer Times</title>
    <link href="https://fonts.googleapis.com/css2?family=Scheherazade+New:wght@400;700&family=DM+Sans:ital,wght@0,300;0,400;0,500;0,600;1,400&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root{
            --midnight:#0d0d1a;--gold:#c9a84c;--gold-light:#f0d080;
            --gold-dim:rgba(201,168,76,0.15);--teal:#0f9b8e;
            --text:#e8e8f0;--text-dim:rgba(232,232,240,0.55);
            --text-muted:rgba(232,232,240,0.3);
            --glass:rgba(255,255,255,0.04);--glass-border:rgba(255,255,255,0.08);
            --radius:18px;--radius-sm:12px;
        }
        *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
        body{font-family:'DM Sans',sans-serif;background:var(--midnight);color:var(--text);min-height:100vh;overflow-x:hidden}
        body::before{content:'';position:fixed;inset:0;background-image:radial-gradient(1px 1px at 12% 8%,rgba(255,255,255,.35) 0%,transparent 100%),radial-gradient(1.5px 1.5px at 55% 12%,rgba(255,255,255,.45) 0%,transparent 100%),radial-gradient(1px 1px at 78% 6%,rgba(255,255,255,.3) 0%,transparent 100%),radial-gradient(1px 1px at 22% 30%,rgba(255,255,255,.2) 0%,transparent 100%),radial-gradient(1px 1px at 65% 25%,rgba(255,255,255,.25) 0%,transparent 100%);pointer-events:none;z-index:0}
        body::after{content:'';position:fixed;top:-20%;left:50%;transform:translateX(-50%);width:80%;height:50%;background:radial-gradient(ellipse,rgba(201,168,76,.05) 0%,transparent 70%);pointer-events:none;z-index:0}

        /* APP SHELL */
        .app{position:relative;z-index:1;max-width:430px;margin:0 auto;height:100vh;display:flex;flex-direction:column;overflow:hidden}

        /* HEADER */
        .header{padding:44px 18px 14px;background:linear-gradient(180deg,rgba(201,168,76,.07) 0%,transparent 100%);border-bottom:1px solid var(--glass-border);flex-shrink:0}
        .header-top{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px}
        .masjid-name{font-family:'Scheherazade New',serif;font-size:1.5em;color:var(--gold);line-height:1.2}
        .masjid-sub{font-size:.7em;color:var(--text-dim);margin-top:2px;font-weight:300}
        .moon-icon{font-size:2em;animation:moonGlow 3s ease-in-out infinite;flex-shrink:0}
        @keyframes moonGlow{0%,100%{filter:drop-shadow(0 0 6px rgba(201,168,76,.4))}50%{filter:drop-shadow(0 0 16px rgba(201,168,76,.85))}}
        .header-info{background:var(--glass);border:1px solid var(--glass-border);border-radius:var(--radius);padding:11px 16px;display:flex;justify-content:space-between;align-items:center;gap:10px}
        .hi-left{display:flex;flex-direction:column;gap:2px;flex:1}
        .clock-date{font-size:.88em;color:var(--text);font-weight:500}
        .clock-hijri{font-family:'Scheherazade New',serif;font-size:.95em;color:var(--gold);margin-top:1px}
        .mode-badge{padding:3px 10px;border-radius:20px;font-size:.63em;font-weight:600;margin-top:3px;display:inline-block;letter-spacing:.5px}
        .mode-badge.ramadan{background:linear-gradient(135deg,var(--gold),#8B6914);color:#1a1100}
        .mode-badge.normal{background:rgba(15,155,142,.2);color:var(--teal);border:1px solid rgba(15,155,142,.3)}

        /* CONTENT */
        .content{flex:1;overflow-y:auto;-webkit-overflow-scrolling:touch;scroll-behavior:smooth}
        .content::-webkit-scrollbar{width:0}
        .gap{height:14px}
        .sec-label{font-size:.63em;text-transform:uppercase;letter-spacing:2px;color:var(--text-muted);font-weight:600;padding:0 16px;margin-bottom:8px}

        /* SCROLL TO TOP */
        .scroll-top-btn{position:fixed;bottom:80px;right:18px;width:46px;height:46px;border-radius:50%;background:linear-gradient(135deg,var(--gold),#8B6914);border:none;color:#1a1100;font-size:1.3em;font-weight:900;display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:9999;box-shadow:0 4px 20px rgba(201,168,76,.5),0 0 0 2px rgba(201,168,76,.2);opacity:0;transform:translateY(16px);transition:opacity .35s ease,transform .35s ease;pointer-events:none;line-height:1}
        .scroll-top-btn.show{opacity:1;transform:translateY(0);pointer-events:auto}

        /* NEXT PRAYER HERO */
        .next-hero{margin:14px 16px 10px;background:linear-gradient(135deg,rgba(201,168,76,.12) 0%,rgba(201,168,76,.03) 100%);border:1px solid rgba(201,168,76,.25);border-radius:var(--radius);padding:18px 20px;position:relative;overflow:hidden}
        .next-hero::before{content:'';position:absolute;top:0;right:0;width:100px;height:100px;background:radial-gradient(circle,rgba(201,168,76,.12) 0%,transparent 70%);border-radius:50%;transform:translate(30%,-30%)}
        .next-label{font-size:.63em;text-transform:uppercase;letter-spacing:2px;color:var(--gold);font-weight:600;margin-bottom:4px}
        .next-name{font-size:1.75em;font-weight:600;color:var(--text);margin-bottom:2px}
        .next-iqama-time{font-family:'DM Mono',monospace;font-size:1.1em;color:var(--gold-light);margin-bottom:2px}
        .next-iqama-label{font-size:.66em;color:var(--text-dim);margin-bottom:10px}
        .countdown-row{background:rgba(0,0,0,.3);border-radius:var(--radius-sm);padding:10px 14px;display:flex;align-items:center;justify-content:space-between}
        .cd-label{font-size:.66em;color:var(--text-dim);text-transform:uppercase;letter-spacing:1px}
        .cd-timer{font-family:'DM Mono',monospace;font-size:1.5em;font-weight:500;color:var(--gold-light);letter-spacing:1px}

        /* IFTAR/SUHOOR */
        .hl-card{margin:0 16px 10px;border-radius:var(--radius);padding:14px 18px;display:flex;justify-content:space-between;align-items:center}
        .hl-card.iftar{background:linear-gradient(135deg,rgba(192,57,43,.12),rgba(192,57,43,.04));border:1px solid rgba(192,57,43,.3)}
        .hl-card.suhoor{background:linear-gradient(135deg,rgba(15,155,142,.12),rgba(15,155,142,.04));border:1px solid rgba(15,155,142,.3)}
        .hl-lbl{font-size:.63em;text-transform:uppercase;letter-spacing:2px;font-weight:600}
        .iftar .hl-lbl{color:#e74c3c}.suhoor .hl-lbl{color:var(--teal)}
        .hl-time{font-family:'DM Mono',monospace;font-size:1.85em;font-weight:500;color:var(--text);margin-top:2px}
        .hl-sub{font-size:.71em;color:var(--text-dim);margin-top:2px}
        .hl-icon{font-size:2.2em;opacity:.8}

        /* PRAYER LIST */
        .prayers-list{padding:0 16px;display:flex;flex-direction:column;gap:7px}
        .pr-row{background:var(--glass);border:1px solid var(--glass-border);border-radius:var(--radius-sm);padding:12px 14px;display:flex;align-items:center;justify-content:space-between;position:relative;overflow:hidden;transition:all .2s}
        .pr-row.current{background:linear-gradient(135deg,rgba(201,168,76,.14),rgba(201,168,76,.04));border-color:rgba(201,168,76,.4)}
        .pr-row.current::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;background:var(--gold);border-radius:3px 0 0 3px}
        .pr-row.passed{opacity:.35}
        .pr-left{display:flex;align-items:center;gap:11px}
        .pr-emoji{font-size:1.25em;width:33px;height:33px;background:var(--glass);border-radius:9px;display:flex;align-items:center;justify-content:center;border:1px solid var(--glass-border);flex-shrink:0}
        .pr-name{font-weight:500;font-size:.9em}
        .pr-sub{font-size:.66em;color:var(--text-dim);margin-top:2px}
        .pr-right{text-align:right}
        .pr-iqama{font-family:'DM Mono',monospace;font-size:1.05em;color:var(--text);font-weight:600}
        .pr-row.current .pr-iqama{color:var(--gold-light)}
        .now-pill{background:var(--gold);color:#1a1100;font-size:.56em;font-weight:700;padding:2px 8px;border-radius:20px;letter-spacing:.5px;margin-top:4px;display:inline-block}

        /* NOTIFICATION MODAL */
        .notif-modal-bg{position:fixed;inset:0;background:rgba(0,0,0,.72);z-index:1000;display:flex;align-items:center;justify-content:center;padding:20px;backdrop-filter:blur(4px)}
        .notif-modal{background:#1a1a2e;border:1px solid rgba(201,168,76,.3);border-radius:24px;padding:26px 22px;max-width:360px;width:100%;text-align:center}
        .notif-modal .bell{font-size:2.8em;margin-bottom:10px}
        .notif-modal h2{font-size:1.15em;color:var(--gold);margin-bottom:7px}
        .notif-modal p{font-size:.82em;color:var(--text-dim);line-height:1.6;margin-bottom:18px}
        .notif-options{display:flex;flex-direction:column;gap:8px;margin-bottom:16px}
        .notif-opt{background:var(--glass);border:1px solid var(--glass-border);border-radius:12px;padding:11px 14px;display:flex;align-items:center;gap:12px;cursor:pointer;transition:all .2s;text-align:left}
        .notif-opt.selected{background:rgba(201,168,76,.12);border-color:rgba(201,168,76,.4)}
        .notif-opt-icon{font-size:1.35em;flex-shrink:0}
        .notif-opt-title{font-size:.86em;font-weight:600;color:var(--text)}
        .notif-opt-sub{font-size:.7em;color:var(--text-dim);margin-top:2px}
        .notif-enable-btn{width:100%;padding:13px;background:linear-gradient(135deg,var(--gold),#8B6914);color:#1a1100;border:none;border-radius:12px;font-family:'DM Sans',sans-serif;font-size:.93em;font-weight:700;cursor:pointer;margin-bottom:8px}
        .notif-skip-btn{background:transparent;border:none;color:var(--text-muted);font-size:.78em;cursor:pointer;font-family:'DM Sans',sans-serif;padding:6px}

        /* NOTIF STATUS BANNER */
        .notif-banner{margin:0 16px 10px;border-radius:var(--radius-sm);padding:11px 14px;display:flex;align-items:center;gap:10px;cursor:pointer}
        .notif-banner.enabled{background:linear-gradient(135deg,rgba(15,155,142,.1),rgba(15,155,142,.03));border:1px solid rgba(15,155,142,.25)}
        .notif-banner.disabled{background:linear-gradient(135deg,rgba(201,168,76,.08),rgba(201,168,76,.02));border:1px solid rgba(201,168,76,.2)}
        .notif-bell{font-size:1.3em;animation:bellRing 4s ease-in-out infinite}
        @keyframes bellRing{0%,100%{transform:rotate(0)}10%,30%{transform:rotate(-12deg)}20%,40%{transform:rotate(12deg)}50%{transform:rotate(0)}}
        .notif-title{font-size:.8em;font-weight:600}
        .notif-banner.enabled .notif-title{color:var(--teal)}
        .notif-banner.disabled .notif-title{color:var(--gold)}
        .notif-sub{font-size:.66em;color:var(--text-dim);margin-top:1px}
        .notif-arrow{margin-left:auto;color:var(--text-muted);font-size:1.1em}

        /* JUMMAH */
        .jummah-notice{margin:0 16px 10px;background:linear-gradient(135deg,rgba(201,168,76,.1),rgba(201,168,76,.03));border:1px solid rgba(201,168,76,.25);border-radius:var(--radius-sm);padding:11px 14px;text-align:center}

        /* ADD TO HOMESCREEN BOTTOM BUTTON */
        .hs-bottom-bar{margin:4px 16px 14px;background:linear-gradient(135deg,rgba(201,168,76,.1),rgba(201,168,76,.03));border:1px solid rgba(201,168,76,.28);border-radius:var(--radius-sm);padding:13px 16px;display:flex;align-items:center;gap:12px;cursor:pointer;transition:all .2s}
        .hs-bottom-bar:active{transform:scale(.98)}
        .hs-bar-icon{font-size:1.5em;flex-shrink:0}
        .hs-bar-title{font-size:.85em;font-weight:600;color:var(--gold)}
        .hs-bar-sub{font-size:.68em;color:var(--text-dim);margin-top:2px}
        .hs-bar-arrow{margin-left:auto;color:var(--gold);font-size:1.1em;opacity:.7}

        /* HOME SCREEN BOTTOM SHEET MODAL */
        .hs-modal-bg{position:fixed;inset:0;background:rgba(0,0,0,.75);z-index:1100;display:flex;align-items:flex-end;justify-content:center;backdrop-filter:blur(5px);animation:bgFade .2s ease}
        @keyframes bgFade{from{opacity:0}to{opacity:1}}
        .hs-modal{background:#1a1a2e;border:1px solid rgba(201,168,76,.3);border-radius:24px 24px 0 0;padding:24px 22px 38px;width:100%;max-width:430px;animation:slideUp .28s ease}
        @keyframes slideUp{from{transform:translateY(100%)}to{transform:translateY(0)}}
        .hs-drag{width:38px;height:4px;background:rgba(255,255,255,.12);border-radius:2px;margin:0 auto 18px}
        .hs-modal-title{font-size:1.1em;color:var(--gold);font-weight:600;text-align:center;margin-bottom:5px}
        .hs-modal-sub{font-size:.8em;color:var(--text-dim);text-align:center;margin-bottom:18px;line-height:1.5}
        /* Platform tabs */
        .hs-ptabs{display:flex;gap:6px;margin-bottom:14px}
        .hs-ptab{flex:1;padding:8px;border-radius:10px;border:1px solid var(--glass-border);background:transparent;color:var(--text-dim);font-family:'DM Sans',sans-serif;font-size:.76em;cursor:pointer;font-weight:500;transition:all .2s}
        .hs-ptab.active{background:var(--gold-dim);border-color:rgba(201,168,76,.4);color:var(--gold)}
        /* Steps */
        .hs-steps{display:flex;flex-direction:column;gap:8px;margin-bottom:18px}
        .hs-step{background:var(--glass);border:1px solid var(--glass-border);border-radius:11px;padding:11px 13px;display:flex;align-items:flex-start;gap:11px}
        .hs-num{width:22px;height:22px;min-width:22px;border-radius:50%;background:linear-gradient(135deg,var(--gold),#8B6914);color:#1a1100;font-weight:700;font-size:.72em;display:flex;align-items:center;justify-content:center;margin-top:1px}
        .hs-step-txt{font-size:.8em;color:var(--text-dim);line-height:1.5}
        .hs-step-txt strong{color:var(--text)}
        /* Native install button */
        .hs-native-btn{width:100%;padding:14px;background:linear-gradient(135deg,var(--gold),#8B6914);color:#1a1100;border:none;border-radius:12px;font-family:'DM Sans',sans-serif;font-size:.93em;font-weight:700;cursor:pointer;margin-bottom:10px;display:none}
        .hs-close-btn{width:100%;padding:11px;background:var(--glass);border:1px solid var(--glass-border);border-radius:12px;color:var(--text-dim);font-family:'DM Sans',sans-serif;font-size:.83em;cursor:pointer}

        /* CALENDAR */
        .month-tabs{display:flex;margin:0 16px 10px;background:var(--glass);border:1px solid var(--glass-border);border-radius:var(--radius-sm);padding:3px;gap:0}
        .month-tab{flex:1;padding:8px;border:none;background:transparent;color:var(--text-dim);border-radius:9px;font-family:'DM Sans',sans-serif;font-size:.78em;font-weight:500;cursor:pointer;transition:all .25s}
        .month-tab.active{background:linear-gradient(135deg,var(--gold),#8B6914);color:#1a1100;font-weight:600}
        .sub-tabs{display:flex;gap:8px;padding:0 16px;margin-bottom:10px}
        .sub-tab{padding:6px 15px;border-radius:20px;border:1px solid var(--glass-border);background:transparent;color:var(--text-dim);font-size:.73em;font-family:'DM Sans',sans-serif;cursor:pointer;font-weight:500;transition:all .2s}
        .sub-tab.active{background:var(--gold-dim);border-color:rgba(201,168,76,.4);color:var(--gold)}
        .cal-card{background:var(--glass);border:1px solid var(--glass-border);border-radius:var(--radius-sm);margin-bottom:7px;overflow:hidden}
        .cal-card.today-card{border-color:rgba(201,168,76,.4);background:linear-gradient(135deg,rgba(201,168,76,.07),var(--glass))}
        .cal-card.odd-night{border-color:rgba(147,51,234,.3)}
        .cal-card.last-ten{border-color:rgba(201,168,76,.2)}
        .cal-hdr{padding:12px 14px;display:flex;align-items:center;cursor:pointer;user-select:none}
        .cal-day-num{font-family:'DM Mono',monospace;font-size:1.35em;font-weight:500;color:var(--gold);width:36px;flex-shrink:0}
        .cal-card.today-card .cal-day-num{color:var(--gold-light)}
        .cal-info{flex:1}
        .cal-day-name{font-weight:500;font-size:.86em}
        .cal-badge{font-size:.63em;color:var(--text-muted);margin-top:1px}
        .cal-iftar-prev{text-align:right;margin-right:8px}
        .cal-iftar-lbl{font-size:.58em;color:#e74c3c;text-transform:uppercase;letter-spacing:1px}
        .cal-iftar-t{font-family:'DM Mono',monospace;font-size:.86em;color:var(--text)}
        .cal-chevron{color:var(--text-muted);font-size:.68em;transition:transform .25s}
        .cal-card.open .cal-chevron{transform:rotate(180deg)}
        .cal-grid{display:none;padding:0 14px 12px;grid-template-columns:repeat(3,1fr);gap:6px}
        .cal-card.open .cal-grid{display:grid}
        .cal-cell{background:rgba(0,0,0,.2);border-radius:8px;padding:8px;text-align:center}
        .cal-cell-lbl{font-size:.58em;color:var(--text-muted);text-transform:uppercase;letter-spacing:.4px}
        .cal-cell-val{font-family:'DM Mono',monospace;font-size:.83em;color:var(--text);margin-top:2px}
        .iftar-v{color:#e74c3c!important;font-weight:600}
        .suhoor-v{color:var(--teal)!important}
        .iqama-v{color:var(--gold)!important}

        /* TABLE */
        .table-wrap{overflow-x:auto;margin:0 16px;border-radius:var(--radius-sm);border:1px solid var(--glass-border)}
        .pt{width:100%;border-collapse:collapse;font-size:.7em;min-width:440px}
        .pt thead{background:linear-gradient(135deg,rgba(201,168,76,.18),rgba(201,168,76,.06))}
        .pt th{padding:10px 7px;text-align:center;color:var(--gold);font-weight:600;font-size:.8em;letter-spacing:.4px;text-transform:uppercase;border-bottom:1px solid var(--glass-border)}
        .pt td{padding:9px 7px;text-align:center;border-bottom:1px solid rgba(255,255,255,.04);color:var(--text-dim);font-family:'DM Mono',monospace;font-size:.91em}
        .pt tr.today-row td{background:rgba(201,168,76,.07);color:var(--gold-light)}
        .pt td:first-child{color:var(--text);font-weight:600;font-family:'DM Sans',sans-serif}
        .pt .iftar-c{color:#e74c3c!important;font-weight:600}
        .pt .suhoor-c{color:var(--teal)!important}
        .pt .iqama-c{color:var(--gold)!important;font-weight:600}

        /* HADITH */
        .hadith-card{background:var(--glass);border:1px solid var(--glass-border);border-radius:var(--radius);padding:20px 17px;margin-bottom:10px;position:relative;overflow:hidden}
        .hadith-card::before{content:'"';position:absolute;top:-10px;left:12px;font-size:7em;color:rgba(201,168,76,.05);font-family:Georgia,serif;line-height:1}
        .hadith-tag{font-size:.6em;text-transform:uppercase;letter-spacing:2px;color:var(--gold);font-weight:600;margin-bottom:10px}
        .hadith-arabic{font-family:'Scheherazade New',serif;font-size:1.4em;text-align:right;direction:rtl;color:var(--gold-light);line-height:1.85;margin-bottom:12px;border-bottom:1px solid var(--glass-border);padding-bottom:12px}
        .hadith-english{font-size:.85em;line-height:1.7;color:var(--text-dim);font-style:italic}
        .hadith-source{margin-top:9px;font-size:.66em;color:var(--text-muted);text-align:right}
        .dua-card{background:linear-gradient(135deg,rgba(15,155,142,.1),var(--glass));border:1px solid rgba(15,155,142,.2);border-radius:var(--radius);padding:17px;margin-bottom:10px}
        .dua-title{font-size:.63em;text-transform:uppercase;letter-spacing:2px;color:var(--teal);font-weight:600;margin-bottom:9px}
        .dua-arabic{font-family:'Scheherazade New',serif;font-size:1.25em;text-align:right;direction:rtl;color:var(--text);line-height:1.9;margin-bottom:7px}
        .dua-translit{font-size:.78em;color:var(--text-dim);font-style:italic;margin-bottom:4px}
        .dua-trans{font-size:.75em;color:var(--text-muted)}

        /* INFO */
        .info-card{background:var(--glass);border:1px solid var(--glass-border);border-radius:var(--radius);padding:17px;margin-bottom:10px}
        .info-title{color:var(--gold);font-weight:600;font-size:.83em;text-transform:uppercase;letter-spacing:1px;margin-bottom:9px}
        .info-body{color:var(--text-dim);font-size:.8em;line-height:1.9}
        .info-body p{margin-bottom:4px}
        .info-body strong{color:var(--text)}
        .info-div{border-top:1px solid var(--glass-border);margin:9px 0}

        /* BOTTOM NAV â€” sticky */
        .bottom-nav{position:sticky;bottom:0;z-index:100;flex-shrink:0;padding:9px 16px 26px;background:rgba(13,13,26,.97);border-top:1px solid var(--glass-border);display:flex;justify-content:space-around;backdrop-filter:blur(20px)}
        .nav-item{display:flex;flex-direction:column;align-items:center;gap:3px;cursor:pointer;padding:6px 13px;border-radius:10px;transition:all .2s;border:none;background:transparent}
        .nav-item.active{background:var(--gold-dim)}
        .nav-icon{font-size:1.3em}
        .nav-label{font-size:.56em;font-weight:500;color:var(--text-muted);letter-spacing:.5px;text-transform:uppercase}
        .nav-item.active .nav-label{color:var(--gold)}

        /* VIEWS */
        .view{display:none}.view.active{display:block}
        .sub-view{display:none}.sub-view.active{display:block}
        .pad{padding:0 16px}
    </style>
</head>
<body>
<div class="app">

    <!-- NOTIFICATION PERMISSION MODAL -->
    <div class="notif-modal-bg" id="notifModal" style="display:none">
        <div class="notif-modal">
            <div class="bell">ğŸ””</div>
            <h2>Prayer Time Alerts</h2>
            <p id="notifModalDesc">Get notified before each prayer so you never miss Salaat. When would you like to be reminded?</p>
            <div class="notif-options">
                <div class="notif-opt selected" id="opt20" onclick="selectNotifOpt(20)">
                    <div class="notif-opt-icon">â°</div>
                    <div><div class="notif-opt-title">20 minutes before</div><div class="notif-opt-sub">Recommended â€” time to prepare</div></div>
                </div>
                <div class="notif-opt" id="opt10" onclick="selectNotifOpt(10)">
                    <div class="notif-opt-icon">ğŸ•</div>
                    <div><div class="notif-opt-title">10 minutes before</div><div class="notif-opt-sub">Quick reminder</div></div>
                </div>
                <div class="notif-opt" id="opt0" onclick="selectNotifOpt(0)">
                    <div class="notif-opt-icon">ğŸ•Œ</div>
                    <div><div class="notif-opt-title">At prayer time</div><div class="notif-opt-sub">Alert when Iqama begins</div></div>
                </div>
            </div>
            <button class="notif-enable-btn" onclick="enableNotifFromModal()">Enable Notifications</button>
            <button class="notif-skip-btn" onclick="skipNotif()">Not now</button>
        </div>
    </div>

    <!-- ADD TO HOME SCREEN MODAL -->
    <div class="hs-modal-bg" id="hsModal" style="display:none" onclick="hsCloseBg(event)">
        <div class="hs-modal">
            <div class="hs-drag"></div>
            <div class="hs-modal-title">ğŸ“² Add to Home Screen</div>
            <div class="hs-modal-sub">Install as an app â€” works offline, loads instantly</div>
            <!-- Native install button (Android Chrome) -->
            <button class="hs-native-btn" id="hsNativeBtn" onclick="triggerNativeInstall()">âš¡ Install App Now</button>
            <!-- Platform tabs (manual instructions) -->
            <div class="hs-ptabs">
                <button class="hs-ptab active" id="hsTabIOS" onclick="hsShowPlatform('ios',this)">ğŸ“± iPhone / iPad</button>
                <button class="hs-ptab" id="hsTabAndroid" onclick="hsShowPlatform('android',this)">ğŸ¤– Android</button>
            </div>
            <div id="hsIOSSteps" class="hs-steps">
                <div class="hs-step"><div class="hs-num">1</div><div class="hs-step-txt">Open in <strong>Safari</strong> browser (not Chrome)</div></div>
                <div class="hs-step"><div class="hs-num">2</div><div class="hs-step-txt">Tap the <strong>Share â™</strong> button at the bottom of Safari</div></div>
                <div class="hs-step"><div class="hs-num">3</div><div class="hs-step-txt">Scroll and tap <strong>"Add to Home Screen"</strong></div></div>
                <div class="hs-step"><div class="hs-num">4</div><div class="hs-step-txt">Tap <strong>"Add"</strong> â€” the app icon appears on your home screen</div></div>
            </div>
            <div id="hsAndroidSteps" class="hs-steps" style="display:none">
                <div class="hs-step"><div class="hs-num">1</div><div class="hs-step-txt">Open in <strong>Chrome</strong> browser</div></div>
                <div class="hs-step"><div class="hs-num">2</div><div class="hs-step-txt">Tap the <strong>â‹® menu</strong> (top right corner)</div></div>
                <div class="hs-step"><div class="hs-num">3</div><div class="hs-step-txt">Tap <strong>"Add to Home screen"</strong></div></div>
                <div class="hs-step"><div class="hs-num">4</div><div class="hs-step-txt">Tap <strong>"Add"</strong> to confirm</div></div>
            </div>
            <button class="hs-close-btn" onclick="closeHSModal()">Close</button>
        </div>
    </div>



    <!-- HEADER -->
    <div class="header">
        <div class="header-top">
            <div>
                <div class="masjid-name">ğŸ•Œ Hamilton Jamia Mosque</div>
                <div class="masjid-sub">921 Heaphy Terrace Â· Hamilton NZ</div>
            </div>
            <div class="moon-icon">ğŸŒ™</div>
        </div>
        <!-- Mosque selector â€” hidden until >1 mosque registered -->
        <div id="mosqueSelector" style="display:none;margin-bottom:10px">
            <div style="font-size:.58em;text-transform:uppercase;letter-spacing:1.5px;color:var(--text-muted);font-weight:600;margin-bottom:6px">ğŸ•Œ Select Mosque</div>
            <div id="mosqueSelectorBtns" style="display:flex;gap:6px;flex-wrap:wrap"></div>
        </div>
        <div class="header-info">
            <div class="hi-left">
                <div class="clock-date" id="liveDate">Loading...</div>
                <div class="clock-hijri" id="hijriDate">Ramadan 1447H</div>
                <div id="modeBadge" class="mode-badge ramadan">âœ¨ Ramadan Day <span id="ramadanDayNum">--</span></div>
            </div>
        </div>
    </div>

    <!-- CONTENT -->
    <div class="content" id="mainContent">

        <!-- HOME VIEW -->
        <div class="view active" id="homeView">
            <div class="gap"></div>
            <div class="next-hero">
                <div class="next-label">â° Next Prayer</div>
                <div class="next-name" id="nextName">Loading...</div>
                <div class="next-iqama-time" id="nextIqamaTime">--:-- --</div>
                <div class="next-iqama-label">Iqama (Congregation) Time</div>
                <div class="countdown-row">
                    <div class="cd-label">Iqama begins in</div>
                    <div class="cd-timer" id="nextCountdown">--:--:--</div>
                </div>
            </div>
            <div class="hl-card iftar" id="iftarCard" style="display:none">
                <div>
                    <div class="hl-lbl">ğŸŒ™ Iftar Tonight</div>
                    <div class="hl-time" id="iftarTimeDisplay">--:--</div>
                    <div class="hl-sub" id="iftarCountSub">Calculating...</div>
                </div>
                <div class="hl-icon">ğŸ½ï¸</div>
            </div>
            <div class="hl-card suhoor" id="suhoorCard" style="display:none">
                <div>
                    <div class="hl-lbl">ğŸŒ… Suhoor Ends</div>
                    <div class="hl-time" id="suhoorTimeDisplay">--:--</div>
                    <div class="hl-sub">Today's last time to eat before Fajr</div>
                </div>
                <div class="hl-icon">ğŸŒ™</div>
            </div>
            <div class="notif-banner disabled" id="notifBanner" onclick="showNotifModal()">
                <div class="notif-bell">ğŸ””</div>
                <div>
                    <div class="notif-title" id="notifBannerTitle">Enable Prayer Notifications</div>
                    <div class="notif-sub" id="notifBannerSub">Tap to get alerted before each prayer</div>
                </div>
                <div class="notif-arrow">â€º</div>
            </div>
            <div class="jummah-notice" id="jummahNotice" style="display:none">
                <div style="font-size:.73em;color:var(--gold);font-weight:600">ğŸ•Œ Jumu'ah Today</div>
                <div style="font-size:.8em;color:var(--text-dim);margin-top:3px">Khutbah begins at <strong style="color:var(--text)">1:40 PM</strong></div>
            </div>
            <div class="sec-label">Today's Iqama Times</div>
            <div class="prayers-list" id="prayerList"></div>
            <div class="gap"></div>
            <!-- Add to Home Screen bottom button -->
            <div class="hs-bottom-bar" id="hsBottomBar" onclick="showHSModal()">
                <div class="hs-bar-icon">ğŸ“²</div>
                <div>
                    <div class="hs-bar-title">Add to Home Screen</div>
                    <div class="hs-bar-sub">Install as an app â€” quick access, works offline</div>
                </div>
                <div class="hs-bar-arrow">â€º</div>
            </div>
            <div class="gap"></div>
        </div>

        <!-- CALENDAR VIEW -->
        <div class="view" id="calendarView">
            <div class="gap"></div>
            <div class="month-tabs">
                <button class="month-tab active" id="tabFeb" onclick="switchMonth('feb',this)">February 2026</button>
                <button class="month-tab" id="tabMar" onclick="switchMonth('mar',this)">March 2026</button>
            </div>
            <div class="sub-tabs">
                <button class="sub-tab active" onclick="switchCalView('cards',this)">ğŸ“‹ Cards</button>
                <button class="sub-tab" onclick="switchCalView('table',this)">ğŸ“Š Table</button>
            </div>
            <div class="sub-view active" id="calCardsView">
                <div class="pad" id="calCards"></div>
            </div>
            <div class="sub-view" id="calTableView">
                <div class="table-wrap">
                    <table class="pt"><thead id="tableHead"></thead><tbody id="tableBody"></tbody></table>
                </div>
            </div>
            <div class="gap"></div>
        </div>

        <!-- HADITH VIEW -->
        <div class="view" id="hadithView">
            <div class="gap"></div>
            <div class="pad">
                <!-- Daily Hadith of the Day -->
                <div style="font-size:.6em;text-transform:uppercase;letter-spacing:2.5px;color:var(--text-muted);font-weight:600;margin-bottom:10px;text-align:center">
                    ğŸ“… Hadith of the Day Â· <span id="hadithDateLabel"></span>
                </div>
                <div class="hadith-card" id="dailyHadithCard">
                    <div class="hadith-tag" id="dailyHadithTag"></div>
                    <div class="hadith-arabic" id="dailyHadithArabic"></div>
                    <div class="hadith-english" id="dailyHadithEnglish"></div>
                    <div class="hadith-source" id="dailyHadithSource"></div>
                </div>
                <!-- Navigation between hadith -->
                <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;gap:10px">
                    <button onclick="prevHadith()" style="flex:1;padding:10px;background:var(--glass);border:1px solid var(--glass-border);border-radius:10px;color:var(--text-dim);font-family:'DM Sans',sans-serif;font-size:.8em;cursor:pointer">â€¹ Previous</button>
                    <div style="font-size:.68em;color:var(--text-muted);text-align:center;flex-shrink:0" id="hadithCounter"></div>
                    <button onclick="nextHadith()" style="flex:1;padding:10px;background:var(--glass);border:1px solid var(--glass-border);border-radius:10px;color:var(--text-dim);font-family:'DM Sans',sans-serif;font-size:.8em;cursor:pointer">Next â€º</button>
                </div>
                <!-- Always-shown duas -->
                <div style="font-size:.6em;text-transform:uppercase;letter-spacing:2.5px;color:var(--text-muted);font-weight:600;margin-bottom:10px;text-align:center">ğŸ¤² Daily Duas</div>
                <div class="dua-card">
                    <div class="dua-title">ğŸŒ… Intention for Fasting (Niyyah)</div>
                    <div class="dua-arabic">Ù†ÙÙˆÙÙŠÙ’ØªÙ ØµÙÙˆÙ’Ù…Ù ØºÙØ¯Ù Ø¹ÙÙ†Ù’ Ø£ÙØ¯ÙØ§Ø¡Ù ÙÙØ±Ù’Ø¶Ù Ø´ÙÙ‡Ù’Ø±Ù Ø±ÙÙ…ÙØ¶ÙØ§Ù†Ù Ù‡ÙØ°ÙÙ‡Ù Ø§Ù„Ø³ÙÙ‘Ù†ÙØ©Ù Ù„ÙÙ„ÙÙ‘Ù‡Ù ØªÙØ¹ÙØ§Ù„ÙÙ‰</div>
                    <div class="dua-translit">Nawaitu sawma ghadin 'an ada'i fardi shahri Ramadana hadhihi-s-sanati lillahi ta'ala</div>
                    <div class="dua-trans">"I intend to keep the fast of Ramadan tomorrow for the sake of Allah"</div>
                </div>
                <div class="dua-card">
                    <div class="dua-title">ğŸŒ™ Breaking Fast (Iftar Dua)</div>
                    <div class="dua-arabic">Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø¥ÙÙ†ÙÙ‘ÙŠ Ù„ÙÙƒÙ ØµÙÙ…Ù’ØªÙ ÙˆÙØ¨ÙÙƒÙ Ø¢Ù…ÙÙ†Ù’ØªÙ ÙˆÙØ¹ÙÙ„ÙÙ‰ Ø±ÙØ²Ù’Ù‚ÙÙƒÙ Ø£ÙÙÙ’Ø·ÙØ±Ù’ØªÙ</div>
                    <div class="dua-translit">Allahumma inni laka sumtu wa bika aamantu wa 'ala rizqika aftartu</div>
                    <div class="dua-trans">"O Allah! I fasted for You and I believe in You and I break my fast with Your sustenance"</div>
                </div>
                <div class="dua-card">
                    <div class="dua-title">ğŸ•Œ Before Entering Mosque</div>
                    <div class="dua-arabic">Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø§ÙÙ’ØªÙØ­Ù’ Ù„ÙÙŠ Ø£ÙØ¨Ù’ÙˆÙØ§Ø¨Ù Ø±ÙØ­Ù’Ù…ÙØªÙÙƒÙ</div>
                    <div class="dua-translit">Allahumma-ftah li abwaba rahmatik</div>
                    <div class="dua-trans">"O Allah, open for me the doors of Your mercy" â€” Muslim 713</div>
                </div>
                <!-- Source attribution -->
                <div style="background:var(--glass);border:1px solid var(--glass-border);border-radius:var(--radius-sm);padding:12px 14px;margin-bottom:10px;text-align:center">
                    <div style="font-size:.68em;color:var(--text-muted)">ğŸ“š Hadith sources: Sahih al-Bukhari, Sahih Muslim, Abu Dawud, Tirmidhi, Ibn Majah</div>
                    <div style="font-size:.63em;color:var(--text-muted);margin-top:4px">Rotates daily through 30 verified hadith Â· Resets each morning</div>
                </div>
            </div>
            <div class="gap"></div>
        </div>

        <!-- INFO VIEW -->
        <div class="view" id="infoView">
            <div class="gap"></div>
            <div class="pad">
                <div class="info-card">
                    <div class="info-title">ğŸ•Œ Hamilton Jamia Mosque</div>
                    <div class="info-body">
                        <p>ğŸ“ 921 Heaphy Terrace, Hamilton</p>
                        <div class="info-div"></div>
                        <p>ğŸ•Œ <strong>Friday Khutbah:</strong> 1:40 PM</p>
                        <p>ğŸŒ™ <strong>Taraweeh:</strong> After Isha nightly in Ramadan</p>
                    </div>
                </div>
                <div class="info-card">
                    <div class="info-title">ğŸ“Œ Important Notes</div>
                    <div class="info-body">
                        <p>â€¢ All times shown are <strong>Iqama (congregation) times</strong></p>
                        <p>â€¢ Iftar/Maghrib from <strong>FIANZ Hamilton calendar</strong></p>
                        <p>â€¢ 3 minutes added to Ramadan Maghrib</p>
                        <p>â€¢ Asr based on <strong>single shadow</strong> method</p>
                        <p>â€¢ Islamic dates subject to <strong>moon sighting</strong></p>
                        <p>â€¢ Iqama times carry forward until next change</p>
                        <p>â€¢ 5 min gap between Suhoor end and Fajr</p>
                    </div>
                </div>
                <div class="info-card">
                    <div class="info-title">ğŸ“± Data Source</div>
                    <div class="info-body">
                        <p><strong>FIANZ</strong> â€” Suhoor &amp; Iftar times</p>
                        <p><strong>Waikato Muslim Association</strong> â€” Iqama times</p>
                    </div>
                </div>
            </div>
            <div class="gap"></div>
        </div>

    </div><!-- end .content -->

    <!-- BOTTOM NAV -->
    <div class="bottom-nav">
        <button class="nav-item active" onclick="switchNav('home',this)"><div class="nav-icon">ğŸ </div><div class="nav-label">Home</div></button>
        <button class="nav-item" onclick="switchNav('calendar',this)"><div class="nav-icon">ğŸ“…</div><div class="nav-label">Calendar</div></button>
        <button class="nav-item" onclick="switchNav('hadith',this)"><div class="nav-icon">ğŸ“–</div><div class="nav-label">Hadith</div></button>
        <button class="nav-item" onclick="switchNav('info',this)"><div class="nav-icon">â„¹ï¸</div><div class="nav-label">Info</div></button>
    </div>
</div>
<!-- SCROLL TO TOP -->
<button class="scroll-top-btn" id="scrollTopBtn" onclick="scrollToTop()">â†‘</button>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CORRECT DATA â€” Cross-verified FIANZ + WMA sources
//
// FIANZ = Suhoor ends, Fajr (adhan), Shuruq, Zuhr, Asr, Iftar/Maghrib, Isha
// WMA   = Iqama (congregation) times â€” carry forward when null
//
// Ramadan 1447H starts Feb 20, 2026 (Day 1 = Fri Feb 20) â€” NZ moon sighting
// Feb 28 = Day 9, Iftar = 8:06 PM âœ“
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// WMA Feb iqama data: fajrIq dhuhrIq asrIq maghIq ishaIq (null = carry forward)
const FEB_DATA=[
 // Pre-Ramadan Feb 1â€“18
 {date:"Feb 1", day:"Sun",fajr:"4:50",fajrIq:"5:20",shuruq:"6:32",dhuhr:"1:33",dhuhrIq:"1:50",asr:"5:22",asrIq:"5:40",magh:"8:32",maghIq:"8:40",isha:"9:59",ishaIq:"10:05",ramadan:false,suhoor:null,iftar:null},
 {date:"Feb 2", day:"Mon",fajr:"4:52",fajrIq:null,  shuruq:"6:33",dhuhr:"1:33",dhuhrIq:null,  asr:"5:22",asrIq:null,  magh:"8:31",maghIq:"8:35",isha:"9:58",ishaIq:null,   ramadan:false,suhoor:null,iftar:null},
 {date:"Feb 3", day:"Tue",fajr:"4:53",fajrIq:null,  shuruq:"6:35",dhuhr:"1:33",dhuhrIq:null,  asr:"5:22",asrIq:null,  magh:"8:30",maghIq:null,  isha:"9:56",ishaIq:null,   ramadan:false,suhoor:null,iftar:null},
 {date:"Feb 4", day:"Wed",fajr:"4:55",fajrIq:null,  shuruq:"6:36",dhuhr:"1:33",dhuhrIq:null,  asr:"5:21",asrIq:null,  magh:"8:30",maghIq:null,  isha:"9:55",ishaIq:null,   ramadan:false,suhoor:null,iftar:null},
 {date:"Feb 5", day:"Thu",fajr:"4:57",fajrIq:null,  shuruq:"6:37",dhuhr:"1:33",dhuhrIq:null,  asr:"5:21",asrIq:null,  magh:"8:29",maghIq:null,  isha:"9:53",ishaIq:"10:00",ramadan:false,suhoor:null,iftar:null},
 {date:"Feb 6", day:"Fri",fajr:"4:58",fajrIq:null,  shuruq:"6:38",dhuhr:"1:33",dhuhrIq:null,  asr:"5:21",asrIq:null,  magh:"8:28",maghIq:null,  isha:"9:52",ishaIq:null,   ramadan:false,suhoor:null,iftar:null},
 {date:"Feb 7", day:"Sat",fajr:"5:00",fajrIq:null,  shuruq:"6:39",dhuhr:"1:33",dhuhrIq:null,  asr:"5:21",asrIq:null,  magh:"8:27",maghIq:null,  isha:"9:51",ishaIq:null,   ramadan:false,suhoor:null,iftar:null},
 {date:"Feb 8", day:"Sun",fajr:"5:01",fajrIq:"5:30",shuruq:"6:40",dhuhr:"1:33",dhuhrIq:null,  asr:"5:21",asrIq:null,  magh:"8:26",maghIq:"8:30",isha:"9:49",ishaIq:null,   ramadan:false,suhoor:null,iftar:null},
 {date:"Feb 9", day:"Mon",fajr:"5:03",fajrIq:null,  shuruq:"6:41",dhuhr:"1:33",dhuhrIq:null,  asr:"5:20",asrIq:null,  magh:"8:25",maghIq:null,  isha:"9:48",ishaIq:"9:55", ramadan:false,suhoor:null,iftar:null},
 {date:"Feb 10",day:"Tue",fajr:"5:04",fajrIq:null,  shuruq:"6:42",dhuhr:"1:33",dhuhrIq:null,  asr:"5:20",asrIq:null,  magh:"8:23",maghIq:null,  isha:"9:46",ishaIq:null,   ramadan:false,suhoor:null,iftar:null},
 {date:"Feb 11",day:"Wed",fajr:"5:06",fajrIq:null,  shuruq:"6:44",dhuhr:"1:33",dhuhrIq:null,  asr:"5:20",asrIq:null,  magh:"8:22",maghIq:null,  isha:"9:45",ishaIq:null,   ramadan:false,suhoor:null,iftar:null},
 {date:"Feb 12",day:"Thu",fajr:"5:07",fajrIq:null,  shuruq:"6:45",dhuhr:"1:33",dhuhrIq:null,  asr:"5:19",asrIq:null,  magh:"8:21",maghIq:null,  isha:"9:43",ishaIq:null,   ramadan:false,suhoor:null,iftar:null},
 {date:"Feb 13",day:"Fri",fajr:"5:09",fajrIq:null,  shuruq:"6:46",dhuhr:"1:33",dhuhrIq:null,  asr:"5:19",asrIq:null,  magh:"8:20",maghIq:"8:25",isha:"9:42",ishaIq:"9:50", ramadan:false,suhoor:null,iftar:null},
 {date:"Feb 14",day:"Sat",fajr:"5:10",fajrIq:"5:40",shuruq:"6:47",dhuhr:"1:33",dhuhrIq:null,  asr:"5:18",asrIq:null,  magh:"8:19",maghIq:null,  isha:"9:40",ishaIq:null,   ramadan:false,suhoor:null,iftar:null},
 {date:"Feb 15",day:"Sun",fajr:"5:12",fajrIq:null,  shuruq:"6:48",dhuhr:"1:33",dhuhrIq:null,  asr:"5:18",asrIq:null,  magh:"8:18",maghIq:null,  isha:"9:38",ishaIq:null,   ramadan:false,suhoor:null,iftar:null},
 {date:"Feb 16",day:"Mon",fajr:"5:13",fajrIq:null,  shuruq:"6:49",dhuhr:"1:33",dhuhrIq:null,  asr:"5:18",asrIq:null,  magh:"8:17",maghIq:null,  isha:"9:37",ishaIq:null,   ramadan:false,suhoor:null,iftar:null},
 {date:"Feb 17",day:"Tue",fajr:"5:15",fajrIq:null,  shuruq:"6:50",dhuhr:"1:33",dhuhrIq:null,  asr:"5:17",asrIq:null,  magh:"8:15",maghIq:null,  isha:"9:35",ishaIq:"9:45", ramadan:false,suhoor:null,iftar:null},
 {date:"Feb 18",day:"Wed",fajr:"5:16",fajrIq:null,  shuruq:"6:51",dhuhr:"1:33",dhuhrIq:null,  asr:"5:17",asrIq:null,  magh:"8:14",maghIq:null,  isha:"9:34",ishaIq:null,   ramadan:false,suhoor:null,iftar:null},
 // RAMADAN STARTS â€” Day 1 = Feb 19
 // WMA Feb 19: fajr 5:18 (no new iqama listed, carries 5:40), maghrib 8:16
 // FIANZ: suhoor 5:13, fajr adhan 5:18, iftar/maghrib 8:18
 {date:"Feb 19",day:"Thu",             fajr:"5:18",fajrIq:null,  shuruq:"6:52",dhuhr:"1:33",dhuhrIq:null,  asr:"5:16",asrIq:null,  magh:"8:16",maghIq:null,  isha:"9:33",ishaIq:null,   ramadan:false,suhoor:null, iftar:null},
 {date:"Feb 20",day:"Fri",ramadanDay:1, fajr:"5:19",fajrIq:null,  shuruq:"6:53",dhuhr:"1:33",dhuhrIq:null,  asr:"5:16",asrIq:null,  magh:"8:15",maghIq:null,  isha:"9:32",ishaIq:null,   ramadan:true,suhoor:"5:14",iftar:"8:17"},
 // WMA Feb 21: new fajr iqama 5:50, new isha iqama 9:40
 {date:"Feb 21",day:"Sat",ramadanDay:2, fajr:"5:20",fajrIq:"5:50",shuruq:"6:55",dhuhr:"1:33",dhuhrIq:null,  asr:"5:15",asrIq:null,  magh:"8:13",maghIq:null,  isha:"9:30",ishaIq:"9:40", ramadan:true,suhoor:"5:15",iftar:"8:15"},
 {date:"Feb 22",day:"Sun",ramadanDay:3, fajr:"5:22",fajrIq:null,  shuruq:"6:56",dhuhr:"1:33",dhuhrIq:null,  asr:"5:14",asrIq:null,  magh:"8:12",maghIq:null,  isha:"9:28",ishaIq:null,   ramadan:true,suhoor:"5:17",iftar:"8:14"},
 // WMA Feb 23: new maghrib iqama 8:20
 {date:"Feb 23",day:"Mon",ramadanDay:4, fajr:"5:23",fajrIq:null,  shuruq:"6:57",dhuhr:"1:32",dhuhrIq:null,  asr:"5:14",asrIq:null,  magh:"8:11",maghIq:"8:20",isha:"9:27",ishaIq:null,   ramadan:true,suhoor:"5:18",iftar:"8:13"},
 {date:"Feb 24",day:"Tue",ramadanDay:5, fajr:"5:25",fajrIq:null,  shuruq:"6:58",dhuhr:"1:32",dhuhrIq:null,  asr:"5:13",asrIq:null,  magh:"8:09",maghIq:null,  isha:"9:25",ishaIq:null,   ramadan:true,suhoor:"5:20",iftar:"8:11"},
 {date:"Feb 25",day:"Wed",ramadanDay:6, fajr:"5:26",fajrIq:null,  shuruq:"6:59",dhuhr:"1:32",dhuhrIq:null,  asr:"5:13",asrIq:null,  magh:"8:08",maghIq:null,  isha:"9:22",ishaIq:null,   ramadan:true,suhoor:"5:21",iftar:"8:10"},
 {date:"Feb 26",day:"Thu",ramadanDay:7, fajr:"5:27",fajrIq:null,  shuruq:"7:00",dhuhr:"1:32",dhuhrIq:null,  asr:"5:12",asrIq:null,  magh:"8:07",maghIq:null,  isha:"9:21",ishaIq:null,   ramadan:true,suhoor:"5:22",iftar:"8:09"},
 // WMA Feb 27: new isha iqama 9:30
 {date:"Feb 27",day:"Fri",ramadanDay:8, fajr:"5:29",fajrIq:null,  shuruq:"7:01",dhuhr:"1:32",dhuhrIq:null,  asr:"5:11",asrIq:null,  magh:"8:05",maghIq:null,  isha:"9:19",ishaIq:"9:30", ramadan:true,suhoor:"5:24",iftar:"8:07"},
 // WMA Feb 28: new maghrib iqama 8:15, new isha iqama 9:55 (from WMA PDF bolded)
 // FIANZ: suhoor 5:25, iftar 8:06
 {date:"Feb 28",day:"Sat",ramadanDay:9,fajr:"5:30",fajrIq:null,  shuruq:"7:02",dhuhr:"1:32",dhuhrIq:null,  asr:"5:11",asrIq:null,  magh:"8:04",maghIq:"8:15",isha:"9:17",ishaIq:null,  ramadan:true,suhoor:"5:25",iftar:"8:06"},
];

// WMA March data â€” verified from PDF
const MAR_DATA=[
 // WMA Mar 1: fajrIq 5:50, dhuhrIq 1:50, asrIq 5:20, maghIq 8:15, ishaIq 9:30
 {date:"Mar 1", day:"Sun",ramadanDay:10,fajr:"5:31",fajrIq:"5:50",shuruq:"7:03",dhuhr:"1:32",dhuhrIq:"1:50",asr:"5:10",asrIq:"5:20",magh:"8:02",maghIq:"8:15",isha:"9:16",ishaIq:"9:30", ramadan:true,suhoor:"5:26",iftar:"8:04"},
 // WMA Mar 2: new fajrIq 6:00
 {date:"Mar 2", day:"Mon",ramadanDay:11,fajr:"5:33",fajrIq:"6:00",shuruq:"7:04",dhuhr:"1:31",dhuhrIq:null,  asr:"5:09",asrIq:null,  magh:"8:01",maghIq:null,  isha:"9:14",ishaIq:null,   ramadan:true,suhoor:"5:28",iftar:"8:03"},
 // WMA Mar 3: new maghIq 8:10
 {date:"Mar 3", day:"Tue",ramadanDay:12,fajr:"5:34",fajrIq:null,  shuruq:"7:05",dhuhr:"1:31",dhuhrIq:null,  asr:"5:08",asrIq:null,  magh:"8:00",maghIq:"8:10",isha:"9:12",ishaIq:null,   ramadan:true,suhoor:"5:29",iftar:"8:02"},
 {date:"Mar 4", day:"Wed",ramadanDay:13,fajr:"5:35",fajrIq:null,  shuruq:"7:06",dhuhr:"1:31",dhuhrIq:null,  asr:"5:08",asrIq:null,  magh:"7:58",maghIq:null,  isha:"9:11",ishaIq:null,   ramadan:true,suhoor:"5:30",iftar:"8:00"},
 // WMA Mar 5: new ishaIq 9:20
 {date:"Mar 5", day:"Thu",ramadanDay:14,fajr:"5:36",fajrIq:null,  shuruq:"7:07",dhuhr:"1:31",dhuhrIq:null,  asr:"5:07",asrIq:null,  magh:"7:57",maghIq:null,  isha:"9:09",ishaIq:"9:20", ramadan:true,suhoor:"5:31",iftar:"7:59"},
 // WMA Mar 6: new maghIq 8:05
 {date:"Mar 6", day:"Fri",ramadanDay:15,fajr:"5:38",fajrIq:null,  shuruq:"7:08",dhuhr:"1:30",dhuhrIq:null,  asr:"5:06",asrIq:null,  magh:"7:55",maghIq:"8:05",isha:"9:07",ishaIq:null,   ramadan:true,suhoor:"5:33",iftar:"7:57"},
 {date:"Mar 7", day:"Sat",ramadanDay:16,fajr:"5:39",fajrIq:null,  shuruq:"7:09",dhuhr:"1:30",dhuhrIq:null,  asr:"5:05",asrIq:null,  magh:"7:54",maghIq:null,  isha:"9:06",ishaIq:null,   ramadan:true,suhoor:"5:34",iftar:"7:56"},
 {date:"Mar 8", day:"Sun",ramadanDay:17,fajr:"5:40",fajrIq:null,  shuruq:"7:10",dhuhr:"1:30",dhuhrIq:null,  asr:"5:04",asrIq:null,  magh:"7:52",maghIq:null,  isha:"9:04",ishaIq:null,   ramadan:true,suhoor:"5:35",iftar:"7:54"},
 // WMA Mar 9: new fajrIq 6:10
 {date:"Mar 9", day:"Mon",ramadanDay:18,fajr:"5:41",fajrIq:"6:10",shuruq:"7:11",dhuhr:"1:30",dhuhrIq:null,  asr:"5:04",asrIq:null,  magh:"7:51",maghIq:null,  isha:"9:02",ishaIq:null,   ramadan:true,suhoor:"5:36",iftar:"7:53"},
 // WMA Mar 10: new maghIq 8:00
 {date:"Mar 10",day:"Tue",ramadanDay:19,fajr:"5:42",fajrIq:null,  shuruq:"7:12",dhuhr:"1:29",dhuhrIq:null,  asr:"5:03",asrIq:null,  magh:"7:49",maghIq:"8:00",isha:"9:01",ishaIq:null,   ramadan:true,suhoor:"5:37",iftar:"7:51"},
 // WMA Mar 11: new ishaIq 9:10
 {date:"Mar 11",day:"Wed",ramadanDay:20,fajr:"5:43",fajrIq:null,  shuruq:"7:13",dhuhr:"1:29",dhuhrIq:null,  asr:"5:02",asrIq:null,  magh:"7:48",maghIq:null,  isha:"8:59",ishaIq:"9:10", ramadan:true,suhoor:"5:38",iftar:"7:50"},
 {date:"Mar 12",day:"Thu",ramadanDay:21,fajr:"5:45",fajrIq:null,  shuruq:"7:14",dhuhr:"1:29",dhuhrIq:null,  asr:"5:01",asrIq:null,  magh:"7:46",maghIq:null,  isha:"8:57",ishaIq:null,   ramadan:true,suhoor:"5:40",iftar:"7:48"},
 // WMA Mar 13: new asrIq 5:10, new maghIq 7:55
 {date:"Mar 13",day:"Fri",ramadanDay:22,fajr:"5:46",fajrIq:null,  shuruq:"7:15",dhuhr:"1:29",dhuhrIq:null,  asr:"5:00",asrIq:"5:10",magh:"7:45",maghIq:"7:55",isha:"8:56",ishaIq:null,   ramadan:true,suhoor:"5:41",iftar:"7:47"},
 {date:"Mar 14",day:"Sat",ramadanDay:23,fajr:"5:47",fajrIq:null,  shuruq:"7:16",dhuhr:"1:28",dhuhrIq:null,  asr:"4:59",asrIq:null,  magh:"7:43",maghIq:null,  isha:"8:54",ishaIq:null,   ramadan:true,suhoor:"5:42",iftar:"7:45"},
 {date:"Mar 15",day:"Sun",ramadanDay:24,fajr:"5:48",fajrIq:null,  shuruq:"7:17",dhuhr:"1:28",dhuhrIq:null,  asr:"4:58",asrIq:null,  magh:"7:42",maghIq:null,  isha:"8:52",ishaIq:null,   ramadan:true,suhoor:"5:43",iftar:"7:44"},
 // WMA Mar 16: new maghIq 7:50
 {date:"Mar 16",day:"Mon",ramadanDay:25,fajr:"5:49",fajrIq:null,  shuruq:"7:18",dhuhr:"1:28",dhuhrIq:null,  asr:"4:57",asrIq:null,  magh:"7:41",maghIq:"7:50",isha:"8:51",ishaIq:null,   ramadan:true,suhoor:"5:44",iftar:"7:43"},
 // WMA Mar 17: new ishaIq 9:00
 {date:"Mar 17",day:"Tue",ramadanDay:26,fajr:"5:50",fajrIq:null,  shuruq:"7:18",dhuhr:"1:28",dhuhrIq:null,  asr:"4:56",asrIq:null,  magh:"7:39",maghIq:null,  isha:"8:49",ishaIq:"9:00", ramadan:true,suhoor:"5:45",iftar:"7:41"},
 // WMA Mar 18: new fajrIq 6:20
 {date:"Mar 18",day:"Wed",ramadanDay:27,fajr:"5:51",fajrIq:"6:20",shuruq:"7:19",dhuhr:"1:27",dhuhrIq:null,  asr:"4:55",asrIq:null,  magh:"7:38",maghIq:null,  isha:"8:48",ishaIq:null,   ramadan:true,suhoor:"5:46",iftar:"7:40"},
 {date:"Mar 19",day:"Thu",ramadanDay:28,fajr:"5:52",fajrIq:null,  shuruq:"7:20",dhuhr:"1:27",dhuhrIq:null,  asr:"4:54",asrIq:null,  magh:"7:36",maghIq:null,  isha:"8:46",ishaIq:null,   ramadan:true,suhoor:"5:47",iftar:"7:38"},
 // WMA Mar 20: new maghIq 7:45
 {date:"Mar 20",day:"Fri",ramadanDay:29,fajr:"5:53",fajrIq:null,  shuruq:"7:21",dhuhr:"1:27",dhuhrIq:null,  asr:"4:53",asrIq:null,  magh:"7:34",maghIq:"7:45",isha:"8:44",ishaIq:null,   ramadan:true,suhoor:"5:48",iftar:"7:36"},
 // Post-Ramadan (Shawwal)
 {date:"Mar 21",day:"Sat",fajr:"5:54",fajrIq:null,  shuruq:"7:22",dhuhr:"1:26",dhuhrIq:null,  asr:"4:52",asrIq:null,  magh:"7:33",maghIq:null,  isha:"8:43",ishaIq:null,   ramadan:false,suhoor:null,iftar:null},
 {date:"Mar 22",day:"Sun",fajr:"5:55",fajrIq:null,  shuruq:"7:23",dhuhr:"1:26",dhuhrIq:null,  asr:"4:51",asrIq:null,  magh:"7:29",maghIq:null,  isha:"8:41",ishaIq:null,   ramadan:false,suhoor:null,iftar:null},
 {date:"Mar 23",day:"Mon",fajr:"5:56",fajrIq:null,  shuruq:"7:24",dhuhr:"1:26",dhuhrIq:null,  asr:"4:50",asrIq:"5:00",magh:"7:27",maghIq:null,  isha:"8:39",ishaIq:"8:50", ramadan:false,suhoor:null,iftar:null},
 {date:"Mar 24",day:"Tue",fajr:"5:57",fajrIq:null,  shuruq:"7:25",dhuhr:"1:26",dhuhrIq:null,  asr:"4:49",asrIq:null,  magh:"7:25",maghIq:"7:35",isha:"8:38",ishaIq:null,   ramadan:false,suhoor:null,iftar:null},
 {date:"Mar 25",day:"Wed",fajr:"5:58",fajrIq:null,  shuruq:"7:26",dhuhr:"1:25",dhuhrIq:null,  asr:"4:48",asrIq:null,  magh:"7:24",maghIq:null,  isha:"8:36",ishaIq:null,   ramadan:false,suhoor:null,iftar:null},
 {date:"Mar 26",day:"Thu",fajr:"5:59",fajrIq:null,  shuruq:"7:27",dhuhr:"1:25",dhuhrIq:null,  asr:"4:47",asrIq:null,  magh:"7:22",maghIq:null,  isha:"8:35",ishaIq:null,   ramadan:false,suhoor:null,iftar:null},
 // WMA Mar 27: new maghIq 7:30
 {date:"Mar 27",day:"Fri",fajr:"6:00",fajrIq:null,  shuruq:"7:28",dhuhr:"1:25",dhuhrIq:null,  asr:"4:46",asrIq:null,  magh:"7:21",maghIq:"7:30",isha:"8:33",ishaIq:null,   ramadan:false,suhoor:null,iftar:null},
 {date:"Mar 28",day:"Sat",fajr:"6:01",fajrIq:null,  shuruq:"7:29",dhuhr:"1:24",dhuhrIq:null,  asr:"4:45",asrIq:null,  magh:"7:19",maghIq:null,  isha:"8:31",ishaIq:null,   ramadan:false,suhoor:null,iftar:null},
 {date:"Mar 29",day:"Sun",fajr:"6:02",fajrIq:null,  shuruq:"7:30",dhuhr:"1:24",dhuhrIq:null,  asr:"4:44",asrIq:null,  magh:"7:18",maghIq:null,  isha:"8:30",ishaIq:null,   ramadan:false,suhoor:null,iftar:null},
 // WMA Mar 30: new maghIq 7:25
 {date:"Mar 30",day:"Mon",fajr:"6:03",fajrIq:null,  shuruq:"7:30",dhuhr:"1:24",dhuhrIq:null,  asr:"4:43",asrIq:null,  magh:"7:16",maghIq:"7:25",isha:"8:28",ishaIq:null,   ramadan:false,suhoor:null,iftar:null},
 {date:"Mar 31",day:"Tue",fajr:"6:04",fajrIq:null,  shuruq:"7:31",dhuhr:"1:23",dhuhrIq:null,  asr:"4:42",asrIq:null,  magh:"7:15",maghIq:null,  isha:"8:27",ishaIq:null,   ramadan:false,suhoor:null,iftar:null},
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RESOLVE CARRY-FORWARD IQAMA TIMES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function resolveIqamas(data){
    let lF="5:20",lD="1:50",lA="5:40",lM="8:40",lI="10:05";
    return data.map(r=>{
        if(r.fajrIq)lF=r.fajrIq;
        if(r.dhuhrIq)lD=r.dhuhrIq;
        if(r.asrIq)lA=r.asrIq;
        if(r.maghIq)lM=r.maghIq;
        if(r.ishaIq)lI=r.ishaIq;
        return{...r,fajrIqR:lF,dhuhrIqR:lD,asrIqR:lA,maghIqR:lM,ishaIqR:lI};
    });
}
const ALL_DATA=resolveIqamas([...FEB_DATA,...MAR_DATA]);
const FEB_R=ALL_DATA.filter(r=>r.date.startsWith('Feb'));
const MAR_R=ALL_DATA.filter(r=>r.date.startsWith('Mar'));

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let currentMonth='feb',currentCalView='cards',deferredInstall=null;
let notifMinutesBefore=20,notifEnabled=false,notifScheduled=false,selectedNotifMin=20;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toDate(ds){
    const[mon,d]=ds.split(' ');
    return new Date(2026,mon==='Feb'?1:2,parseInt(d));
}
function parseTo24(t,pm){
    if(!t)return null;
    let[h,m]=t.split(':').map(Number);
    if(pm&&h<12)h+=12;
    if(!pm&&h===12)h=0;
    return{h,m};
}
function makeDate(h,m,off=0){
    const d=new Date();d.setHours(h,m,0,0);
    if(off)d.setDate(d.getDate()+off);
    return d;
}
function fmtCd(ms){
    if(ms<=0)return'00:00:00';
    const h=Math.floor(ms/3600000),m=Math.floor((ms%3600000)/60000),s=Math.floor((ms%60000)/1000);
    return`${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
}
function todayRec(){
    const ns=new Date().toDateString();
    return ALL_DATA.find(r=>toDate(r.date).toDateString()===ns);
}
function tmrRec(){
    const rec=todayRec();if(!rec)return null;
    const i=ALL_DATA.findIndex(r=>r.date===rec.date);
    return i>=0&&i<ALL_DATA.length-1?ALL_DATA[i+1]:null;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CLOCK + HOME UPDATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateClock(){
    const now=new Date();
    const days=['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
    const months=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
    document.getElementById('liveDate').textContent=`${days[now.getDay()]}, ${now.getDate()} ${months[now.getMonth()]}`;
    updateHome(now);
    if(notifEnabled&&!notifScheduled)scheduleNotifications().catch(()=>{});
}

function updateHome(now){
    const rec=todayRec(),tmr=tmrRec();
    const badge=document.getElementById('modeBadge');
    if(rec&&rec.ramadan){
        badge.className='mode-badge ramadan';
        badge.innerHTML=`âœ¨ Ramadan Day <span>${rec.ramadanDay}</span>`;
        document.getElementById('hijriDate').textContent='Ramadan 1447H';
        document.getElementById('iftarCard').style.display='flex';
        document.getElementById('suhoorCard').style.display='flex';
    }else if(rec){
        badge.className='mode-badge normal';
        badge.textContent='ğŸ•Œ Daily Salaat';
        document.getElementById('hijriDate').textContent='Shaban / Shawwal 1447H';
        document.getElementById('iftarCard').style.display='none';
        document.getElementById('suhoorCard').style.display='none';
    }
    const jn=document.getElementById('jummahNotice');
    if(jn)jn.style.display=(rec&&rec.day==='Fri')?'block':'none';
    if(!rec)return;

    const prayers=[
        {name:'Fajr',   emoji:'ğŸŒ…',iqama:rec.fajrIqR, pm:false},
        {name:'Dhuhr',  emoji:'â˜€ï¸', iqama:rec.dhuhrIqR,pm:true},
        {name:'Asr',    emoji:'ğŸŒ¤ï¸', iqama:rec.asrIqR,  pm:true},
        {name:'Maghrib',emoji:'ğŸŒ†',iqama:rec.maghIqR, pm:true,isIftar:rec.ramadan},
        {name:'Isha',   emoji:'ğŸŒƒ',iqama:rec.ishaIqR, pm:true},
    ];
    let nextP=null;
    for(const p of prayers){
        const t=parseTo24(p.iqama,p.pm);if(!t)continue;
        const pd=makeDate(t.h,t.m);
        if(pd>now){nextP={...p,date:pd};break;}
    }
    if(!nextP&&tmr){
        const t=parseTo24(tmr.fajrIqR,false);
        if(t){const pd=makeDate(t.h,t.m,1);nextP={name:'Fajr',emoji:'ğŸŒ…',iqama:tmr.fajrIqR,pm:false,date:pd};}
    }
    if(nextP){
        document.getElementById('nextName').textContent=nextP.name+(nextP.isIftar?' / Iftar':'');
        document.getElementById('nextIqamaTime').textContent=`${nextP.iqama} ${nextP.pm?'PM':'AM'}`;
        document.getElementById('nextCountdown').textContent=fmtCd(nextP.date-now);
    }
    // Iftar countdown
    if(rec.ramadan&&rec.iftar){
        const t=parseTo24(rec.iftar,true);
        const iftDt=makeDate(t.h,t.m);
        document.getElementById('iftarTimeDisplay').textContent=`${rec.iftar} PM`;
        const diff=iftDt-now;
        document.getElementById('iftarCountSub').textContent=diff>0?`${fmtCd(diff)} remaining`:'âœ… Iftar time has passed';
    }
    // Suhoor â€” always show TODAY's suhoor time only
    if(rec.ramadan&&rec.suhoor)document.getElementById('suhoorTimeDisplay').textContent=`${rec.suhoor} AM`;

    // Prayer list
    const list=document.getElementById('prayerList');
    list.innerHTML='';
    let nSet=false;
    for(const p of prayers){
        const t=parseTo24(p.iqama,p.pm);if(!t)continue;
        const pd=makeDate(t.h,t.m);
        const passed=pd<=now,isCur=!passed&&!nSet;
        if(isCur)nSet=true;
        const extra=p.isIftar?' / Iftar':'';
        const tw=(p.name==='Isha'&&rec.ramadan)?' + Taraweeh':'';
        const row=document.createElement('div');
        row.className=`pr-row${passed?' passed':''}${isCur?' current':''}`;
        row.innerHTML=`<div class="pr-left"><div class="pr-emoji">${p.emoji}</div><div><div class="pr-name">${p.name}${extra}${tw}</div><div class="pr-sub">Congregation time</div></div></div><div class="pr-right"><div class="pr-iqama">${p.iqama} ${p.pm?'PM':'AM'}</div>${isCur?'<div class="now-pill">NEXT â€º</div>':''}</div>`;
        list.appendChild(row);
    }
    if(rec.ramadan&&rec.suhoor){
        const row=document.createElement('div');
        row.className='pr-row';
        row.style.cssText='border-color:rgba(15,155,142,.3);background:linear-gradient(135deg,rgba(15,155,142,.07),rgba(255,255,255,.04))';
        row.innerHTML=`<div class="pr-left"><div class="pr-emoji">ğŸŒ™</div><div><div class="pr-name" style="color:var(--teal)">Suhoor Ends</div><div class="pr-sub">Today's last time to eat</div></div></div><div class="pr-right"><div class="pr-iqama" style="color:var(--teal)">${rec.suhoor} AM</div></div>`;
        list.appendChild(row);
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NOTIFICATIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.selectNotifOpt=function(min){
    selectedNotifMin=min;
    document.querySelectorAll('.notif-opt').forEach(o=>o.classList.remove('selected'));
    document.getElementById('opt'+min).classList.add('selected');
};
window.showNotifModal=function(){document.getElementById('notifModal').style.display='flex';};
window.skipNotif=function(){
    document.getElementById('notifModal').style.display='none';
    localStorage.setItem('notifAsked','true');
};
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NOTIFICATION SYSTEM â€” iOS Compatible
// iOS requires notifications go through
// Service Worker (showNotification), NOT
// new Notification() which is blocked.
// Also requires PWA installed (home screen)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function getSWRegistration() {
    if (!('serviceWorker' in navigator)) return null;
    try {
        const reg = await navigator.serviceWorker.ready;
        return reg;
    } catch(e) { return null; }
}

window.enableNotifFromModal = async function() {
    notifMinutesBefore = selectedNotifMin;
    document.getElementById('notifModal').style.display = 'none';
    localStorage.setItem('notifAsked', 'true');

    // iOS requires PWA installed
    if (isIOS && !isStandalone) {
        showToast('ğŸ“² Add to Home Screen first, then enable notifications');
        return;
    }

    if (!('Notification' in window) && !('serviceWorker' in navigator)) {
        showToast('âŒ Notifications not supported on this browser');
        return;
    }

    try {
        const permission = await Notification.requestPermission();
        if (permission === 'granted') {
            notifEnabled = true;
            localStorage.setItem('notifEnabled', 'true');
            localStorage.setItem('notifMinutes', String(notifMinutesBefore));
            updateNotifBanner(true);
            await scheduleNotifications();
            showToast(`âœ… Notifications set â€” ${notifMinutesBefore > 0 ? notifMinutesBefore + ' min before' : 'at'} each prayer`);
        } else if (permission === 'denied') {
            showToast('âŒ Blocked â€” go to Settings â†’ Safari/App â†’ Notifications to allow');
        } else {
            showToast('âŒ Permission not granted');
        }
    } catch(e) {
        showToast('âŒ Could not enable notifications: ' + e.message);
    }
};

function updateNotifBanner(on) {
    const b = document.getElementById('notifBanner');
    document.getElementById('notifBannerTitle').textContent = on ? 'ğŸ”” Notifications Active' : 'Enable Prayer Notifications';
    document.getElementById('notifBannerSub').textContent = on
        ? `Alerting ${notifMinutesBefore} min before each prayer`
        : 'Tap to get alerted before each prayer';
    b.className = on ? 'notif-banner enabled' : 'notif-banner disabled';
}

async function scheduleNotifications() {
    if (!notifEnabled || Notification.permission !== 'granted') return;
    notifScheduled = true;
    const rec = todayRec(); if (!rec) return;
    const now = new Date();

    // Get service worker registration â€” REQUIRED for iOS
    const swReg = await getSWRegistration();

    const prayers = [
        {name:'Fajr',   iqama:rec.fajrIqR, pm:false},
        {name:'Dhuhr',  iqama:rec.dhuhrIqR,pm:true},
        {name:'Asr',    iqama:rec.asrIqR,  pm:true},
        {name:'Maghrib',iqama:rec.maghIqR, pm:true},
        {name:'Isha',   iqama:rec.ishaIqR, pm:true}
    ];

    // Build notification list for SW postMessage (iOS method)
    const swNotifications = [];

    prayers.forEach(p => {
        const t = parseTo24(p.iqama, p.pm); if (!t) return;
        const prayerDate = makeDate(t.h, t.m);
        const notifTime = new Date(prayerDate - notifMinutesBefore * 60000);
        const delay = notifTime - now;

        if (delay > 0 && delay < 86400000) {
            const title = `ğŸ•Œ ${p.name}${notifMinutesBefore > 0 ? ` in ${notifMinutesBefore} min` : ''}`;
            const body = `Iqama at ${p.iqama} ${p.pm ? 'PM' : 'AM'} â€” Hamilton Jamia Mosque`;

            // Add to SW schedule (works on iOS)
            swNotifications.push({ title, body, tag: p.name, delayMs: delay });

            // Also schedule via setTimeout + SW showNotification (belt-and-suspenders)
            setTimeout(() => {
                const opts = {
                    body, icon: '/prayer-times/icon-192.png',
                    badge: '/prayer-times/icon-192.png',
                    tag: p.name, renotify: true, vibrate: [200, 100, 200]
                };
                if (swReg) {
                    swReg.showNotification(title, opts).catch(() => {
                        if (Notification.permission === 'granted') new Notification(title, opts);
                    });
                } else if (Notification.permission === 'granted') {
                    new Notification(title, opts);
                }
            }, delay);
        }
    });

    // Iftar notification (Ramadan only)
    if (rec.ramadan && rec.iftar) {
        const t = parseTo24(rec.iftar, true);
        if (t) {
            const iftarDate = makeDate(t.h, t.m);
            const delay = iftarDate - 5 * 60000 - now;
            if (delay > 0) {
                const title = 'ğŸŒ™ Iftar in 5 minutes!';
                const body = `Break your fast at ${rec.iftar} PM`;
                swNotifications.push({ title, body, tag: 'iftar', delayMs: delay });
                setTimeout(() => {
                    const opts = {
                        body, icon: '/prayer-times/icon-192.png',
                        badge: '/prayer-times/icon-192.png',
                        tag: 'iftar', renotify: true, vibrate: [300, 100, 300]
                    };
                    if (swReg) {
                        swReg.showNotification(title, opts).catch(() => {
                            if (Notification.permission === 'granted') new Notification(title, opts);
                        });
                    } else if (Notification.permission === 'granted') {
                        new Notification(title, opts);
                    }
                }, delay);
            }
        }
    }

    // Send schedule to SW via postMessage â€” the PRIMARY iOS method
    // SW receives this and uses its own setTimeout + showNotification
    if (swReg && swReg.active && swNotifications.length > 0) {
        swReg.active.postMessage({
            type: 'SCHEDULE_NOTIFICATIONS',
            notifications: swNotifications
        });
    }
}
function showToast(msg){
    const t=document.createElement('div');
    t.style.cssText='position:fixed;bottom:88px;left:50%;transform:translateX(-50%);background:#1a1a2e;border:1px solid rgba(201,168,76,.3);color:var(--text);padding:10px 18px;border-radius:20px;font-size:.8em;z-index:2000;white-space:nowrap;max-width:88vw;text-align:center';
    t.textContent=msg;document.body.appendChild(t);
    setTimeout(()=>t.remove(),3500);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HOME SCREEN INSTALL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.addEventListener('beforeinstallprompt',e=>{
    e.preventDefault();deferredInstall=e;
    // Show native button in modal
    document.getElementById('hsNativeBtn').style.display='block';
    // Show bottom bar
    document.getElementById('hsBottomBar').style.display='flex';
});

const isIOS=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;
const isStandalone=window.matchMedia('(display-mode: standalone)').matches||window.navigator.standalone===true;

window.showHSModal=function(){
    // On Android with native prompt: trigger directly, no modal needed
    if(deferredInstall){
        triggerNativeInstall();
        return;
    }
    // Otherwise show instructions modal
    // Auto-select correct platform tab
    if(isIOS)hsShowPlatform('ios',document.getElementById('hsTabIOS'));
    else hsShowPlatform('android',document.getElementById('hsTabAndroid'));
    document.getElementById('hsModal').style.display='flex';
};
window.triggerNativeInstall=function(){
    if(deferredInstall){
        deferredInstall.prompt();
        deferredInstall.userChoice.then(r=>{
            if(r.outcome==='accepted'){
                deferredInstall=null;
                document.getElementById('hsBottomBar').style.display='none';
                document.getElementById('hsModal').style.display='none';
                showToast('âœ… App installed! Find it on your home screen');
            }
        });
    }
};
window.closeHSModal=function(){document.getElementById('hsModal').style.display='none';};
window.hsCloseBg=function(e){if(e.target.id==='hsModal')closeHSModal();};
window.hsShowPlatform=function(p,el){
    document.querySelectorAll('.hs-ptab').forEach(t=>t.classList.remove('active'));
    el.classList.add('active');
    document.getElementById('hsIOSSteps').style.display=p==='ios'?'flex':'none';
    document.getElementById('hsAndroidSteps').style.display=p==='android'?'flex':'none';
    document.getElementById('hsIOSSteps').style.flexDirection='column';
};

// Hide bottom bar only if already installed as PWA
if(isStandalone){
    document.addEventListener('DOMContentLoaded',()=>{
        document.getElementById('hsBottomBar').style.display='none';
    });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCROLL TO TOP â€” watches .content div
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.scrollToTop=function(){
    document.getElementById('mainContent').scrollTo({top:0,behavior:'smooth'});
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CALENDAR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildCalendar(){buildCalCards();buildCalTable();}

function buildCalCards(){
    const container=document.getElementById('calCards');
    container.innerHTML='';
    const data=currentMonth==='feb'?FEB_R:MAR_R;
    const nowStr=new Date().toDateString();
    let scrollTarget=null;
    data.forEach(r=>{
        const isToday=toDate(r.date).toDateString()===nowStr;
        const isOdd=r.ramadan&&[21,23,25,27,29].includes(r.ramadanDay);
        const isLast10=r.ramadan&&r.ramadanDay>=21;
        let badge='';
        if(r.ramadanDay===1)badge='ğŸŒŸ First Night';
        else if(r.ramadanDay===15)badge='ğŸ‰ Halfway';
        else if(r.ramadanDay===27)badge='ğŸŒ™âœ¨ Laylatul Qadr';
        else if(r.ramadanDay===30)badge='ğŸŠ Last Night';
        else if(isOdd)badge='âœ¨ Odd Night';
        else if(isLast10)badge='ğŸŒ™ Last 10 Nights';
        else if(r.day==='Fri')badge="ğŸ•Œ Jumu'ah";
        let cls='cal-card';
        if(isToday)cls+=' today-card open';
        else if(isOdd)cls+=' odd-night';
        else if(isLast10)cls+=' last-ten';
        const dayLabel=r.ramadanDay?`Ramadan Day ${r.ramadanDay}`:'';
        const card=document.createElement('div');
        card.className=cls;
        card.innerHTML=`<div class="cal-hdr" onclick="this.parentElement.classList.toggle('open')">
            <div class="cal-day-num">${r.ramadanDay||r.date.split(' ')[1]}</div>
            <div class="cal-info"><div class="cal-day-name">${r.day}, ${r.date}${isToday?' â€” Today':''}</div><div class="cal-badge">${dayLabel}${dayLabel&&badge?' Â· ':''}${badge}</div></div>
            ${r.ramadan&&r.iftar?`<div class="cal-iftar-prev"><div class="cal-iftar-lbl">Iftar</div><div class="cal-iftar-t">${r.iftar} PM</div></div>`:''}
            <div class="cal-chevron">â–¼</div></div>
            <div class="cal-grid">
                ${r.suhoor?`<div class="cal-cell"><div class="cal-cell-lbl">Suhoor Ends</div><div class="cal-cell-val suhoor-v">${r.suhoor} AM</div></div>`:''}
                <div class="cal-cell"><div class="cal-cell-lbl">Fajr Iqama</div><div class="cal-cell-val iqama-v">${r.fajrIqR} AM</div></div>
                <div class="cal-cell"><div class="cal-cell-lbl">Shuruq</div><div class="cal-cell-val">${r.shuruq} AM</div></div>
                <div class="cal-cell"><div class="cal-cell-lbl">Dhuhr Iqama</div><div class="cal-cell-val iqama-v">${r.dhuhrIqR} PM</div></div>
                <div class="cal-cell"><div class="cal-cell-lbl">Asr Iqama</div><div class="cal-cell-val iqama-v">${r.asrIqR} PM</div></div>
                <div class="cal-cell"><div class="cal-cell-lbl">Maghrib Iqama</div><div class="cal-cell-val iqama-v">${r.maghIqR} PM</div></div>
                ${r.iftar?`<div class="cal-cell"><div class="cal-cell-lbl">Iftar</div><div class="cal-cell-val iftar-v">${r.iftar} PM</div></div>`:''}
                <div class="cal-cell"><div class="cal-cell-lbl">Isha Iqama</div><div class="cal-cell-val iqama-v">${r.ishaIqR} PM</div></div>
            </div>`;
        container.appendChild(card);
        if(isToday)scrollTarget=card;
    });
    if(scrollTarget)setTimeout(()=>scrollTarget.scrollIntoView({behavior:'smooth',block:'center'}),300);
}

function buildCalTable(){
    const data=currentMonth==='feb'?FEB_R:MAR_R;
    const nowStr=new Date().toDateString();
    const isRam=data.some(r=>r.ramadan);
    document.getElementById('tableHead').innerHTML=isRam
        ?`<tr><th>Day</th><th>Date</th><th>Suhoor</th><th>Fajr Iqama</th><th>Dhuhr Iqama</th><th>Asr Iqama</th><th>Iftar</th><th>Maghrib Iqama</th><th>Isha Iqama</th></tr>`
        :`<tr><th>Date</th><th>Day</th><th>Fajr Iqama</th><th>Dhuhr Iqama</th><th>Asr Iqama</th><th>Maghrib Iqama</th><th>Isha Iqama</th></tr>`;
    const tbody=document.getElementById('tableBody');tbody.innerHTML='';
    data.forEach(r=>{
        const isToday=toDate(r.date).toDateString()===nowStr;
        const tr=document.createElement('tr');
        if(isToday)tr.className='today-row';
        if(isRam){
            tr.innerHTML=`<td>${r.ramadanDay||'â€”'}</td><td style="font-family:'DM Sans',sans-serif;color:var(--text)">${r.day} ${r.date}</td><td class="suhoor-c">${r.suhoor||'â€”'}</td><td class="iqama-c">${r.fajrIqR} AM</td><td class="iqama-c">${r.dhuhrIqR} PM</td><td class="iqama-c">${r.asrIqR} PM</td><td class="iftar-c">${r.iftar||'â€”'}</td><td class="iqama-c">${r.maghIqR} PM</td><td class="iqama-c">${r.ishaIqR} PM</td>`;
        }else{
            tr.innerHTML=`<td style="font-family:'DM Sans',sans-serif;color:var(--text)">${r.date}</td><td style="font-family:'DM Sans',sans-serif">${r.day}</td><td class="iqama-c">${r.fajrIqR} AM</td><td class="iqama-c">${r.dhuhrIqR} PM</td><td class="iqama-c">${r.asrIqR} PM</td><td class="iqama-c">${r.maghIqR} PM</td><td class="iqama-c">${r.ishaIqR} PM</td>`;
        }
        tbody.appendChild(tr);
    });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAV
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.switchNav=function(view,el){
    document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
    el.classList.add('active');
    document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
    document.getElementById(view+'View').classList.add('active');
    document.getElementById('mainContent').scrollTo({top:0,behavior:'instant'});
    if(view==='calendar'){
        const m=new Date().getMonth();
        if(m===1)window.switchMonth('feb',document.getElementById('tabFeb'));
        else if(m===2)window.switchMonth('mar',document.getElementById('tabMar'));
    }
};
window.switchMonth=function(m,el){
    currentMonth=m;
    document.querySelectorAll('.month-tab').forEach(t=>t.classList.remove('active'));
    el.classList.add('active');
    buildCalCards();buildCalTable();
};
window.switchCalView=function(v,el){
    currentCalView=v;
    document.querySelectorAll('.sub-tab').forEach(t=>t.classList.remove('active'));
    el.classList.add('active');
    document.getElementById('calCardsView').classList.toggle('active',v==='cards');
    document.getElementById('calTableView').classList.toggle('active',v==='table');
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HADITH BANK â€” 30 authentic hadith
// Rotates daily: day-of-year mod 30
// Sources: Sahih al-Bukhari, Sahih Muslim,
//          Abu Dawud, Tirmidhi, Ibn Majah
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const HADITH_BANK = [
    {
        topic:"Fasting â€” Sincere Faith",
        arabic:"Ù…ÙÙ†Ù’ ØµÙØ§Ù…Ù Ø±ÙÙ…ÙØ¶ÙØ§Ù†Ù Ø¥ÙÙŠÙ…ÙØ§Ù†Ù‹Ø§ ÙˆÙØ§Ø­Ù’ØªÙØ³ÙØ§Ø¨Ù‹Ø§ ØºÙÙÙØ±Ù Ù„ÙÙ‡Ù Ù…ÙØ§ ØªÙÙ‚ÙØ¯ÙÙ‘Ù…Ù Ù…ÙÙ†Ù’ Ø°ÙÙ†Ù’Ø¨ÙÙ‡Ù",
        english:"Whoever fasts during Ramadan out of sincere faith and hoping to attain Allah's rewards, then all his past sins will be forgiven.",
        source:"Sahih al-Bukhari 38"
    },
    {
        topic:"Ramadan â€” Gates of Jannah",
        arabic:"Ø¥ÙØ°ÙØ§ Ø¬ÙØ§Ø¡Ù Ø±ÙÙ…ÙØ¶ÙØ§Ù†Ù ÙÙØªÙÙ‘Ø­ÙØªÙ’ Ø£ÙØ¨Ù’ÙˆÙØ§Ø¨Ù Ø§Ù„Ù’Ø¬ÙÙ†ÙÙ‘Ø©Ù ÙˆÙØºÙÙ„ÙÙ‘Ù‚ÙØªÙ’ Ø£ÙØ¨Ù’ÙˆÙØ§Ø¨Ù Ø§Ù„Ù†ÙÙ‘Ø§Ø±Ù ÙˆÙØµÙÙÙÙ‘Ø¯ÙØªÙ Ø§Ù„Ø´ÙÙ‘ÙŠÙØ§Ø·ÙÙŠÙ†Ù",
        english:"When the month of Ramadan starts, the gates of Jannah are opened, the gates of Hell are closed, and the devils are chained.",
        source:"Sahih al-Bukhari 1899"
    },
    {
        topic:"Laylatul Qadr",
        arabic:"ØªÙØ­ÙØ±ÙÙ‘ÙˆÙ’Ø§ Ù„ÙÙŠÙ’Ù„ÙØ©Ù Ø§Ù„Ù’Ù‚ÙØ¯Ù’Ø±Ù ÙÙÙŠ Ø§Ù„Ù’ÙˆÙØªÙ’Ø±Ù Ù…ÙÙ†Ù Ø§Ù„Ù’Ø¹ÙØ´Ù’Ø±Ù Ø§Ù„Ø£ÙÙˆÙØ§Ø®ÙØ±Ù Ù…ÙÙ†Ù’ Ø±ÙÙ…ÙØ¶ÙØ§Ù†Ù",
        english:"Seek Laylatul Qadr in the odd nights of the last ten days of Ramadan.",
        source:"Sahih al-Bukhari 2017"
    },
    {
        topic:"Prayer â€” The Best Deed",
        arabic:"Ø£ÙØ­ÙØ¨ÙÙ‘ Ø§Ù„Ø£ÙØ¹Ù’Ù…ÙØ§Ù„Ù Ø¥ÙÙ„ÙÙ‰ Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø£ÙØ¯Ù’ÙˆÙÙ…ÙÙ‡ÙØ§ ÙˆÙØ¥ÙÙ†Ù’ Ù‚ÙÙ„ÙÙ‘",
        english:"The most beloved deeds to Allah are the most regular and constant, even if they are few.",
        source:"Sahih al-Bukhari 6464"
    },
    {
        topic:"Salah â€” First Account",
        arabic:"Ø¥ÙÙ†ÙÙ‘ Ø£ÙÙˆÙÙ‘Ù„Ù Ù…ÙØ§ ÙŠÙØ­ÙØ§Ø³ÙØ¨Ù Ø¨ÙÙ‡Ù Ø§Ù„Ù’Ø¹ÙØ¨Ù’Ø¯Ù ÙŠÙÙˆÙ’Ù…Ù Ø§Ù„Ù’Ù‚ÙÙŠÙØ§Ù…ÙØ©Ù Ù…ÙÙ†Ù’ Ø¹ÙÙ…ÙÙ„ÙÙ‡Ù Ø§Ù„ØµÙÙ‘Ù„ÙØ§Ø©Ù",
        english:"The first deed for which a servant will be held accountable on the Day of Resurrection is the prayer.",
        source:"Abu Dawud 864"
    },
    {
        topic:"Quran â€” Best of You",
        arabic:"Ø®ÙÙŠÙ’Ø±ÙÙƒÙÙ…Ù’ Ù…ÙÙ†Ù’ ØªÙØ¹ÙÙ„ÙÙ‘Ù…Ù Ø§Ù„Ù’Ù‚ÙØ±Ù’Ø¢Ù†Ù ÙˆÙØ¹ÙÙ„ÙÙ‘Ù…ÙÙ‡Ù",
        english:"The best of you are those who learn the Quran and teach it.",
        source:"Sahih al-Bukhari 5027"
    },
    {
        topic:"Charity in Ramadan",
        arabic:"ÙƒÙØ§Ù†Ù Ø§Ù„Ù†ÙÙ‘Ø¨ÙÙŠÙÙ‘ ØµÙÙ„ÙÙ‘Ù‰ Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø¹ÙÙ„ÙÙŠÙ’Ù‡Ù ÙˆÙØ³ÙÙ„ÙÙ‘Ù…Ù Ø£ÙØ¬Ù’ÙˆÙØ¯Ù Ø§Ù„Ù†ÙÙ‘Ø§Ø³Ù ÙˆÙÙƒÙØ§Ù†Ù Ø£ÙØ¬Ù’ÙˆÙØ¯Ù Ù…ÙØ§ ÙŠÙÙƒÙÙˆÙ†Ù ÙÙÙŠ Ø±ÙÙ…ÙØ¶ÙØ§Ù†Ù",
        english:"The Prophet (ï·º) was the most generous of all people, and he used to be even more generous in Ramadan.",
        source:"Sahih al-Bukhari 1902"
    },
    {
        topic:"Dua â€” Power of Supplication",
        arabic:"Ø§Ù„Ø¯ÙÙ‘Ø¹ÙØ§Ø¡Ù Ù‡ÙÙˆÙ Ø§Ù„Ù’Ø¹ÙØ¨ÙØ§Ø¯ÙØ©Ù",
        english:"Supplication is worship itself.",
        source:"Tirmidhi 3372"
    },
    {
        topic:"Fasting â€” Shield",
        arabic:"Ø§Ù„ØµÙÙ‘ÙŠÙØ§Ù…Ù Ø¬ÙÙ†ÙÙ‘Ø©ÙŒ",
        english:"Fasting is a shield.",
        source:"Sahih al-Bukhari 1894"
    },
    {
        topic:"Brotherhood â€” Smile",
        arabic:"ØªÙØ¨ÙØ³ÙÙ‘Ù…ÙÙƒÙ ÙÙÙŠ ÙˆÙØ¬Ù’Ù‡Ù Ø£ÙØ®ÙÙŠÙƒÙ Ù„ÙÙƒÙ ØµÙØ¯ÙÙ‚ÙØ©ÙŒ",
        english:"Your smile for your brother is charity.",
        source:"Tirmidhi 1956"
    },
    {
        topic:"Honesty â€” Leads to Good",
        arabic:"Ø¹ÙÙ„ÙÙŠÙ’ÙƒÙÙ…Ù’ Ø¨ÙØ§Ù„ØµÙÙ‘Ø¯Ù’Ù‚Ù ÙÙØ¥ÙÙ†ÙÙ‘ Ø§Ù„ØµÙÙ‘Ø¯Ù’Ù‚Ù ÙŠÙÙ‡Ù’Ø¯ÙÙŠ Ø¥ÙÙ„ÙÙ‰ Ø§Ù„Ù’Ø¨ÙØ±ÙÙ‘ ÙˆÙØ¥ÙÙ†ÙÙ‘ Ø§Ù„Ù’Ø¨ÙØ±ÙÙ‘ ÙŠÙÙ‡Ù’Ø¯ÙÙŠ Ø¥ÙÙ„ÙÙ‰ Ø§Ù„Ù’Ø¬ÙÙ†ÙÙ‘Ø©Ù",
        english:"Be truthful, for truthfulness leads to righteousness, and righteousness leads to Paradise.",
        source:"Sahih al-Bukhari 6094"
    },
    {
        topic:"Kindness to Parents",
        arabic:"Ø±ÙØ¶ÙØ§ Ø§Ù„Ù„ÙÙ‘Ù‡Ù ÙÙÙŠ Ø±ÙØ¶ÙØ§ Ø§Ù„Ù’ÙˆÙØ§Ù„ÙØ¯ÙÙŠÙ’Ù†Ù ÙˆÙØ³ÙØ®ÙØ·Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù ÙÙÙŠ Ø³ÙØ®ÙØ·Ù Ø§Ù„Ù’ÙˆÙØ§Ù„ÙØ¯ÙÙŠÙ’Ù†Ù",
        english:"The pleasure of Allah is in the pleasure of parents, and the displeasure of Allah is in the displeasure of parents.",
        source:"Tirmidhi 1899"
    },
    {
        topic:"Ramadan â€” Forgiveness",
        arabic:"Ù…ÙÙ†Ù’ Ù‚ÙØ§Ù…Ù Ø±ÙÙ…ÙØ¶ÙØ§Ù†Ù Ø¥ÙÙŠÙ…ÙØ§Ù†Ù‹Ø§ ÙˆÙØ§Ø­Ù’ØªÙØ³ÙØ§Ø¨Ù‹Ø§ ØºÙÙÙØ±Ù Ù„ÙÙ‡Ù Ù…ÙØ§ ØªÙÙ‚ÙØ¯ÙÙ‘Ù…Ù Ù…ÙÙ†Ù’ Ø°ÙÙ†Ù’Ø¨ÙÙ‡Ù",
        english:"Whoever stands in prayer during Ramadan with faith and seeking reward, his previous sins will be forgiven.",
        source:"Sahih al-Bukhari 37"
    },
    {
        topic:"Neighbours â€” Rights",
        arabic:"Ù…ÙØ§ Ø²ÙØ§Ù„Ù Ø¬ÙØ¨Ù’Ø±ÙÙŠÙ„Ù ÙŠÙÙˆØµÙÙŠÙ†ÙÙŠ Ø¨ÙØ§Ù„Ù’Ø¬ÙØ§Ø±Ù Ø­ÙØªÙÙ‘Ù‰ Ø¸ÙÙ†ÙÙ†Ù’ØªÙ Ø£ÙÙ†ÙÙ‘Ù‡Ù Ø³ÙÙŠÙÙˆÙØ±ÙÙ‘Ø«ÙÙ‡Ù",
        english:"Jibreel kept advising me to treat neighbours well, to the point I thought he would give them the right of inheritance.",
        source:"Sahih al-Bukhari 6014"
    },
    {
        topic:"Knowledge â€” Obligation",
        arabic:"Ø·ÙÙ„ÙØ¨Ù Ø§Ù„Ù’Ø¹ÙÙ„Ù’Ù…Ù ÙÙØ±ÙÙŠØ¶ÙØ©ÙŒ Ø¹ÙÙ„ÙÙ‰ ÙƒÙÙ„ÙÙ‘ Ù…ÙØ³Ù’Ù„ÙÙ…Ù",
        english:"Seeking knowledge is an obligation upon every Muslim.",
        source:"Ibn Majah 224"
    },
    {
        topic:"Patience â€” Limitless Reward",
        arabic:"Ø¥ÙÙ†ÙÙ‘Ù…ÙØ§ ÙŠÙÙˆÙÙÙÙ‘Ù‰ Ø§Ù„ØµÙÙ‘Ø§Ø¨ÙØ±ÙÙˆÙ†Ù Ø£ÙØ¬Ù’Ø±ÙÙ‡ÙÙ…Ù’ Ø¨ÙØºÙÙŠÙ’Ø±Ù Ø­ÙØ³ÙØ§Ø¨Ù",
        english:"Indeed, the patient will be given their reward without account.",
        source:"Sahih Muslim 2999"
    },
    {
        topic:"Tawheed â€” Greatest Dhikr",
        arabic:"Ø£ÙÙÙ’Ø¶ÙÙ„Ù Ø§Ù„Ø°ÙÙ‘ÙƒÙ’Ø±Ù Ù„ÙØ§ Ø¥ÙÙ„ÙÙ‡Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ø§Ù„Ù„ÙÙ‘Ù‡Ù",
        english:"The best form of remembrance is: There is no god worthy of worship except Allah.",
        source:"Tirmidhi 3383"
    },
    {
        topic:"Character â€” Perfecting Morals",
        arabic:"Ø¥ÙÙ†ÙÙ‘Ù…ÙØ§ Ø¨ÙØ¹ÙØ«Ù’ØªÙ Ù„ÙØ£ÙØªÙÙ…ÙÙ‘Ù…Ù Ù…ÙÙƒÙØ§Ø±ÙÙ…Ù Ø§Ù„Ù’Ø£ÙØ®Ù’Ù„ÙØ§Ù‚Ù",
        english:"I was only sent to perfect good character.",
        source:"Ahmad 8952"
    },
    {
        topic:"Mercy â€” Allah's Mercy",
        arabic:"Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø£ÙØ±Ù’Ø­ÙÙ…Ù Ø¨ÙØ¹ÙØ¨ÙØ§Ø¯ÙÙ‡Ù Ù…ÙÙ†Ù’ Ù‡ÙØ°ÙÙ‡Ù Ø¨ÙÙˆÙÙ„ÙØ¯ÙÙ‡ÙØ§",
        english:"Allah is more merciful to His servants than this mother is to her child.",
        source:"Sahih al-Bukhari 5999"
    },
    {
        topic:"Remembrance â€” Life of the Heart",
        arabic:"Ù…ÙØ«ÙÙ„Ù Ø§Ù„ÙÙ‘Ø°ÙÙŠ ÙŠÙØ°Ù’ÙƒÙØ±Ù Ø±ÙØ¨ÙÙ‘Ù‡Ù ÙˆÙØ§Ù„ÙÙ‘Ø°ÙÙŠ Ù„ÙØ§ ÙŠÙØ°Ù’ÙƒÙØ±Ù Ù…ÙØ«ÙÙ„Ù Ø§Ù„Ù’Ø­ÙÙŠÙÙ‘ ÙˆÙØ§Ù„Ù’Ù…ÙÙŠÙÙ‘ØªÙ",
        english:"The example of one who remembers his Lord and one who does not is like the living and the dead.",
        source:"Sahih al-Bukhari 6407"
    },
    {
        topic:"Wudu â€” Erases Sins",
        arabic:"Ø¥ÙØ°ÙØ§ ØªÙÙˆÙØ¶ÙÙ‘Ø£Ù Ø§Ù„Ù’Ø¹ÙØ¨Ù’Ø¯Ù Ø§Ù„Ù’Ù…ÙØ³Ù’Ù„ÙÙ…Ù Ø®ÙØ±ÙØ¬ÙØªÙ’ Ø®ÙØ·ÙØ§ÙŠÙØ§Ù‡Ù Ù…ÙÙ†Ù’ ÙŠÙØ¯ÙÙŠÙ’Ù‡Ù Ù…ÙØ¹Ù Ø§Ù„Ù’Ù…ÙØ§Ø¡Ù",
        english:"When a Muslim performs wudu, his sins fall from his hands with the water.",
        source:"Sahih Muslim 244"
    },
    {
        topic:"Intention â€” Heart of Deeds",
        arabic:"Ø¥ÙÙ†ÙÙ‘Ù…ÙØ§ Ø§Ù„Ø£ÙØ¹Ù’Ù…ÙØ§Ù„Ù Ø¨ÙØ§Ù„Ù†ÙÙ‘ÙŠÙÙ‘Ø§ØªÙ",
        english:"Actions are judged by intentions.",
        source:"Sahih al-Bukhari 1"
    },
    {
        topic:"Jummah â€” Best Day",
        arabic:"Ø®ÙÙŠÙ’Ø±Ù ÙŠÙÙˆÙ’Ù…Ù Ø·ÙÙ„ÙØ¹ÙØªÙ’ Ø¹ÙÙ„ÙÙŠÙ’Ù‡Ù Ø§Ù„Ø´ÙÙ‘Ù…Ù’Ø³Ù ÙŠÙÙˆÙ’Ù…Ù Ø§Ù„Ù’Ø¬ÙÙ…ÙØ¹ÙØ©Ù",
        english:"The best day on which the sun rises is Friday.",
        source:"Sahih Muslim 854"
    },
    {
        topic:"Salah â€” Light of the Believer",
        arabic:"Ø§Ù„ØµÙÙ‘Ù„ÙØ§Ø©Ù Ù†ÙÙˆØ±ÙŒ",
        english:"Prayer is light.",
        source:"Sahih Muslim 223"
    },
    {
        topic:"Forgiveness â€” Allah's Door",
        arabic:"Ù„ÙÙˆÙ’ Ø£ÙÙ†ÙÙ‘ÙƒÙÙ…Ù’ Ø£ÙØ®Ù’Ø·ÙØ£Ù’ØªÙÙ…Ù’ Ø­ÙØªÙÙ‘Ù‰ ØªÙØ¨Ù’Ù„ÙØºÙ Ø®ÙØ·ÙØ§ÙŠÙØ§ÙƒÙÙ…Ù’ Ø§Ù„Ø³ÙÙ‘Ù…ÙØ§Ø¡Ù Ø«ÙÙ…ÙÙ‘ ØªÙØ¨Ù’ØªÙÙ…Ù’ Ù„ÙØªÙØ§Ø¨Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø¹ÙÙ„ÙÙŠÙ’ÙƒÙÙ…Ù’",
        english:"If your sins were to reach the clouds of the sky, and then you sought forgiveness, Allah would forgive you.",
        source:"Ibn Majah 4248"
    },
    {
        topic:"Sadaqah â€” Does Not Decrease",
        arabic:"Ù…ÙØ§ Ù†ÙÙ‚ÙØµÙØªÙ’ ØµÙØ¯ÙÙ‚ÙØ©ÙŒ Ù…ÙÙ†Ù’ Ù…ÙØ§Ù„Ù",
        english:"Charity does not decrease wealth.",
        source:"Sahih Muslim 2588"
    },
    {
        topic:"Greetings â€” Spreading Salam",
        arabic:"Ø£ÙÙÙ’Ø´ÙÙˆØ§ Ø§Ù„Ø³ÙÙ‘Ù„ÙØ§Ù…Ù Ø¨ÙÙŠÙ’Ù†ÙÙƒÙÙ…Ù’",
        english:"Spread the greeting of peace among yourselves.",
        source:"Sahih Muslim 54"
    },
    {
        topic:"Tawbah â€” Repentance",
        arabic:"ÙƒÙÙ„ÙÙ‘ Ø§Ø¨Ù’Ù†Ù Ø¢Ø¯ÙÙ…Ù Ø®ÙØ·ÙÙ‘Ø§Ø¡ÙŒ ÙˆÙØ®ÙÙŠÙ’Ø±Ù Ø§Ù„Ù’Ø®ÙØ·ÙÙ‘Ø§Ø¦ÙÙŠÙ†Ù Ø§Ù„ØªÙÙ‘ÙˆÙÙ‘Ø§Ø¨ÙÙˆÙ†Ù",
        english:"Every son of Adam sins, and the best of those who sin are those who repent.",
        source:"Tirmidhi 2499"
    },
    {
        topic:"Community â€” United",
        arabic:"Ø§Ù„Ù’Ù…ÙØ¤Ù’Ù…ÙÙ†Ù Ù„ÙÙ„Ù’Ù…ÙØ¤Ù’Ù…ÙÙ†Ù ÙƒÙØ§Ù„Ù’Ø¨ÙÙ†Ù’ÙŠÙØ§Ù†Ù ÙŠÙØ´ÙØ¯ÙÙ‘ Ø¨ÙØ¹Ù’Ø¶ÙÙ‡Ù Ø¨ÙØ¹Ù’Ø¶Ù‹Ø§",
        english:"A believer to another believer is like a building, each part strengthening the other.",
        source:"Sahih al-Bukhari 481"
    },
    {
        topic:"Gratitude â€” Increases Blessings",
        arabic:"Ù„ÙØ¦ÙÙ†Ù’ Ø´ÙÙƒÙØ±Ù’ØªÙÙ…Ù’ Ù„ÙØ£ÙØ²ÙÙŠØ¯ÙÙ†ÙÙ‘ÙƒÙÙ…Ù’",
        english:"If you are grateful, I will surely increase you in favour.",
        source:"Quran 14:7 (narrated by the Prophet ï·º)"
    },
    {
        topic:"Taraweeh â€” Night Prayer",
        arabic:"Ù…ÙÙ†Ù’ Ù‚ÙØ§Ù…Ù Ù…ÙØ¹Ù Ø§Ù„Ø¥ÙÙ…ÙØ§Ù…Ù Ø­ÙØªÙÙ‘Ù‰ ÙŠÙÙ†Ù’ØµÙØ±ÙÙÙ ÙƒÙØªÙØ¨Ù Ù„ÙÙ‡Ù Ù‚ÙÙŠÙØ§Ù…Ù Ù„ÙÙŠÙ’Ù„ÙØ©Ù",
        english:"Whoever prays with the imam until he finishes, it will be recorded for him as if he prayed the whole night.",
        source:"Abu Dawud 1375"
    }
];

let currentHadithIdx = 0;

function getDailyHadithIndex() {
    const now = new Date();
    const start = new Date(now.getFullYear(), 0, 0);
    const diff = now - start;
    const dayOfYear = Math.floor(diff / 86400000);
    return dayOfYear % HADITH_BANK.length;
}

function renderHadith(idx) {
    const h = HADITH_BANK[idx];
    const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
    const now = new Date();
    document.getElementById('hadithDateLabel').textContent =
        `${now.getDate()} ${months[now.getMonth()]} ${now.getFullYear()}`;
    document.getElementById('dailyHadithTag').textContent = `ğŸ“– ${h.topic}`;
    document.getElementById('dailyHadithArabic').textContent = h.arabic;
    document.getElementById('dailyHadithEnglish').textContent = `"${h.english}"`;
    document.getElementById('dailyHadithSource').textContent = `â€” ${h.source}`;
    document.getElementById('hadithCounter').textContent = `${idx + 1} / ${HADITH_BANK.length}`;
}

function prevHadith() {
    currentHadithIdx = (currentHadithIdx - 1 + HADITH_BANK.length) % HADITH_BANK.length;
    renderHadith(currentHadithIdx);
}

function nextHadith() {
    currentHadithIdx = (currentHadithIdx + 1) % HADITH_BANK.length;
    renderHadith(currentHadithIdx);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MULTI-MOSQUE SYSTEM
// Mosques are registered in localStorage
// key: 'mosques' â†’ JSON array of mosque objects
// Active mosque stored as 'activeMosqueId'
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const DEFAULT_MOSQUE = {
    id: 'hamilton-jamia',
    name: 'Hamilton Jamia Mosque',
    shortName: 'Hamilton Jamia',
    address: '921 Heaphy Terrace, Hamilton',
    jummahTime: '1:40 PM'
};

function getMosques() {
    try {
        const stored = localStorage.getItem('mosques');
        if (stored) return JSON.parse(stored);
    } catch(e) {}
    return [DEFAULT_MOSQUE];
}

function getActiveMosqueId() {
    return localStorage.getItem('activeMosqueId') || DEFAULT_MOSQUE.id;
}

function getActiveMosque() {
    const mosques = getMosques();
    const id = getActiveMosqueId();
    return mosques.find(m => m.id === id) || mosques[0] || DEFAULT_MOSQUE;
}

function setActiveMosque(id) {
    localStorage.setItem('activeMosqueId', id);
    updateMosqueUI();
    // Re-render current view
    updateClock();
}

function updateMosqueUI() {
    const mosques = getMosques();
    const active = getActiveMosque();

    // Update header name
    document.querySelector('.masjid-name').textContent = 'ğŸ•Œ ' + active.name;
    document.querySelector('.masjid-sub').textContent = active.address;

    // Update info card
    const infoTitle = document.querySelector('#infoView .info-title');
    if (infoTitle) infoTitle.textContent = 'ğŸ•Œ ' + active.name;
    const infoBody = document.querySelector('#infoView .info-body');
    if (infoBody) {
        infoBody.querySelector('p').textContent = 'ğŸ“ ' + active.address;
    }

    // Show/hide mosque selector
    const selector = document.getElementById('mosqueSelector');
    const btnsDiv = document.getElementById('mosqueSelectorBtns');
    if (mosques.length > 1) {
        selector.style.display = 'block';
        btnsDiv.innerHTML = '';
        mosques.forEach(m => {
            const btn = document.createElement('button');
            btn.textContent = m.shortName || m.name;
            btn.style.cssText = `padding:6px 14px;border-radius:20px;border:1px solid ${m.id === active.id ? 'rgba(201,168,76,.5)' : 'rgba(255,255,255,.1)'};background:${m.id === active.id ? 'rgba(201,168,76,.15)' : 'transparent'};color:${m.id === active.id ? 'var(--gold)' : 'rgba(232,232,240,.5)'};font-family:"DM Sans",sans-serif;font-size:.74em;cursor:pointer;font-weight:${m.id === active.id ? '600' : '400'};transition:all .2s`;
            btn.onclick = () => setActiveMosque(m.id);
            btnsDiv.appendChild(btn);
        });
    } else {
        selector.style.display = 'none';
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SERVICE WORKER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
if('serviceWorker' in navigator){
    window.addEventListener('load',()=>navigator.serviceWorker.register('/prayer-times/sw.js').catch(()=>{}));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.addEventListener('DOMContentLoaded',()=>{
    // Restore notification prefs
    if(localStorage.getItem('notifEnabled')==='true'){
        notifEnabled=true;
        notifMinutesBefore=parseInt(localStorage.getItem('notifMinutes')||'20');
        selectedNotifMin=notifMinutesBefore;
        updateNotifBanner(true);
    }
    // iOS-specific warning in notification modal
    if(isIOS && !isStandalone){
        const p=document.getElementById('notifModalDesc');
        if(p) p.innerHTML='<strong style="color:var(--gold)">iPhone users:</strong> Notifications only work when this app is installed to your home screen.<br><br>Tap <strong>Share â†’ Add to Home Screen</strong> in Safari first, then open from your home screen and enable notifications here.';
    }

    // Show notification modal on first visit after 2s
    if(!localStorage.getItem('notifAsked')){
        setTimeout(()=>document.getElementById('notifModal').style.display='flex',2000);
    }

    // Scroll to top button â€” watches #mainContent
    const content=document.getElementById('mainContent');
    const btn=document.getElementById('scrollTopBtn');
    content.addEventListener('scroll',()=>{
        btn.classList.toggle('show',content.scrollTop>280);
    });

    buildCalendar();
    updateClock();
    setInterval(updateClock,1000);

    // Hadith â€” show today's by default, allow browsing
    currentHadithIdx = getDailyHadithIndex();
    renderHadith(currentHadithIdx);

    // Mosque selector
    updateMosqueUI();
});
</script>
</body>
</html>
